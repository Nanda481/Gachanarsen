<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>High-Tier Gacha Showcase ‚Ä¢ Limited Summon</title>
  <meta name="description" content="High-end cinematic gacha showcase with summon limits ‚Äî dual mode: Showcase & Gacha."/>
  <style>
    /* ... (CSS sebelumnya tetap sama) ... */

    /* Summon Limit Styles */
    .summon-limit {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.05);
      margin: 10px 0;
      position: relative;
      z-index: 1;
    }
    
    .limit-counter {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .limit-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00C851;
      transition: all 0.3s ease;
    }
    
    .limit-dot.used {
      background: #ff4444;
    }
    
    .limit-text {
      color: var(--muted);
      font-size: 11px;
    }
    
    .cooldown-timer {
      background: linear-gradient(45deg, #ff4444, #cc0000);
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      display: none;
      align-items: center;
      gap: 4px;
    }
    
    .cooldown-timer.show {
      display: flex;
    }
    
    .summon-disabled {
      position: relative;
    }
    
    .summon-disabled::after {
      content: 'LIMIT REACHED';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,0,0,0.1);
      backdrop-filter: blur(5px);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ff4444;
      font-weight: 800;
      font-size: 12px;
      border: 2px solid rgba(255,0,0,0.3);
    }
    
    .refresh-notification {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: linear-gradient(45deg, var(--accent-a), var(--accent-b));
      color: #021226;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 700;
      z-index: 90;
      box-shadow: 0 10px 30px rgba(57,210,255,0.3);
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .refresh-notification.show {
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="top" role="banner" aria-label="Header utama">
      <div class="shine-effect"></div>
      <div class="brand">
        <div class="logo" aria-label="Logo Gacha">G</div>
        <div>
          <div class="title">Gacha ‚Ä¢ Event Showcase 
            <span class="subscription-badge" id="subBadge" style="display: none;">
              <span>‚úì</span> SUBSCRIBED
            </span>
          </div>
          <div class="subtitle">Limited Summon ‚Ä¢ 5 Summons Daily</div>
        </div>
      </div>

      <nav class="controls" aria-label="Navigasi kontrol">
        <button id="modeBtn" class="btn ghost small">Mode: Showcase</button>
        <button id="openChannel" class="btn small">Verify Subscription</button>
        <button id="enableBtn" class="btn primary" style="display: none;">Access Gacha</button>
      </nav>
    </header>

    <main class="main" role="main" aria-label="Konten utama">
      <!-- LEFT: info -->
      <aside class="left" aria-label="Informasi panel">
        <div class="card">
          <h4>Subscription Required</h4>
          <div class="security-status">
            <div class="status-dot" id="statusDot"></div>
            <div class="status-text" id="statusText">Verification Required</div>
          </div>
          <p class="muted">Subscribe to our YouTube channel to unlock summon features.</p>
        </div>

        <div class="card">
          <h4>Summon Limits</h4>
          <div class="summon-limit">
            <div class="limit-counter" id="limitCounter">
              <!-- Dots akan diisi oleh JavaScript -->
            </div>
            <div class="limit-text">5 summons per day</div>
          </div>
          <div class="cooldown-timer" id="cooldownTimer">
            <span>‚è∞</span>
            <span id="cooldownText">Resets in: 24:00:00</span>
          </div>
          <p class="muted">Daily limit: 5 summons ‚Ä¢ Resets every 24 hours</p>
        </div>

        <div class="card">
          <h4>Rarity Rates</h4>
          <p class="muted" id="ratesSummary">Mythic: 2% ‚Ä¢ Legendary: 8% ‚Ä¢ Elite: 20% ‚Ä¢ Common: 70%</p>
        </div>
      </aside>

      <!-- CENTER: showcase & gacha -->
      <section class="center" aria-label="Area showcase dan gacha">
        <div class="bg-container" id="bgContainer"></div>
        <div class="bg-overlay"></div>

        <!-- SHOWCASE MODE -->
        <div class="showcase-wrap" id="showcaseWrap">
          <!-- ... (showcase content sama seperti sebelumnya) ... -->
        </div>

        <!-- GACHA MODE -->
        <div class="gacha-board hide" id="gachaBoard" aria-label="Portal summon gacha">
          <div style="display:flex;flex-direction:column;gap:8px;min-width:200px;position:relative;z-index:1">
            <div style="font-weight:800; font-size:16px">Summon Portal</div>
            <div class="muted" style="font-size:13px">
              <span id="summonsLeft">5</span> summons remaining today
            </div>
          </div>

          <div class="gtiles" id="gtiles" style="position:relative;z-index:1">
            <!-- 6 box thumbnails dengan gambar mod -->
            <div class="gtile"><img src="assets/thumbnails/thumb1.jpg" style="width:100%;height:100%;object-fit:cover" alt="Aurelia Mod" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb2.jpg" style="width:100%;height:100%;object-fit:cover" alt="Korven Mod" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb3.jpg" style="width:100%;height:100%;object-fit:cover" alt="Sibyl Mod" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb4.jpg" style="width:100%;height:100%;object-fit:cover" alt="Truffle Mod" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb5.jpg" style="width:100%;height:100%;object-fit:cover" alt="Rebecca Mod" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb6.jpg" style="width:100%;height:100%;object-fit:cover" alt="Fen Mod" onerror="handleImageError(this)"></div>
          </div>

          <div style="display:flex;flex-direction:column;gap:12px;align-items:center;position:relative;z-index:1">
            <button id="summonBtn" class="spin-btn" disabled>SUMMON</button>
            <button id="singleSummon" class="btn small" disabled>Single</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Refresh Notification -->
  <div class="refresh-notification" id="refreshNotification">
    <span>üîÑ</span>
    Summon limits reset daily at midnight!
  </div>

  <!-- ... (modal, result overlay, notification sama seperti sebelumnya) ... -->
</body>

<script>
/************************************************************************
 * ENHANCED GACHA SYSTEM WITH SUMMON LIMITS
 * - 5 summons per day limit
 * - 24-hour cooldown system
 * - Anti-spam protection
 * - Visual limit indicators
 ************************************************************************/

/* ---------------------- SUMMON LIMIT SYSTEM ---------------------- */
class SummonLimitSystem {
  constructor() {
    this.MAX_SUMMONS = 5;
    this.COOLDOWN_DURATION = 24 * 60 * 60 * 1000; // 24 jam
    this.STORAGE_KEYS = {
      SUMMON_COUNT: 'gacha_summon_count',
      LAST_SUMMON_DATE: 'gacha_last_summon_date',
      RESET_TIMESTAMP: 'gacha_reset_timestamp'
    };
    
    this.currentSummons = 0;
    this.resetTime = null;
    this.init();
  }

  init() {
    this.loadSummonData();
    this.updateUI();
    this.startCooldownTimer();
  }

  loadSummonData() {
    // Cek apakah sudah reset hari ini
    const today = new Date().toDateString();
    const lastSummonDate = localStorage.getItem(this.STORAGE_KEYS.LAST_SUMMON_DATE);
    
    if (lastSummonDate !== today) {
      // Reset untuk hari baru
      this.resetDailyLimits();
      return;
    }

    // Load data dari localStorage
    this.currentSummons = parseInt(localStorage.getItem(this.STORAGE_KEYS.SUMMON_COUNT)) || 0;
    const savedResetTime = localStorage.getItem(this.STORAGE_KEYS.RESET_TIMESTAMP);
    
    if (savedResetTime) {
      this.resetTime = new Date(parseInt(savedResetTime));
    } else {
      this.setResetTime();
    }
  }

  resetDailyLimits() {
    this.currentSummons = 0;
    const today = new Date().toDateString();
    
    localStorage.setItem(this.STORAGE_KEYS.SUMMON_COUNT, '0');
    localStorage.setItem(this.STORAGE_KEYS.LAST_SUMMON_DATE, today);
    this.setResetTime();
    
    console.log('üéØ Daily summon limits reset');
  }

  setResetTime() {
    // Set reset time untuk besok jam 00:00
    const now = new Date();
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);
    
    this.resetTime = tomorrow;
    localStorage.setItem(this.STORAGE_KEYS.RESET_TIMESTAMP, tomorrow.getTime().toString());
  }

  canSummon() {
    return this.currentSummons < this.MAX_SUMMONS;
  }

  incrementSummon() {
    if (!this.canSummon()) {
      return false;
    }

    this.currentSummons++;
    const today = new Date().toDateString();
    
    localStorage.setItem(this.STORAGE_KEYS.SUMMON_COUNT, this.currentSummons.toString());
    localStorage.setItem(this.STORAGE_KEYS.LAST_SUMMON_DATE, today);
    
    this.updateUI();
    this.showSummonNotification();
    
    return true;
  }

  getRemainingSummons() {
    return this.MAX_SUMMONS - this.currentSummons;
  }

  getTimeUntilReset() {
    const now = new Date();
    const diff = this.resetTime - now;
    
    if (diff <= 0) {
      this.resetDailyLimits();
      return { hours: 0, minutes: 0, seconds: 0 };
    }
    
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    
    return { hours, minutes, seconds };
  }

  updateUI() {
    const limitCounter = document.getElementById('limitCounter');
    const summonsLeft = document.getElementById('summonsLeft');
    const cooldownTimer = document.getElementById('cooldownTimer');
    const summonBtn = document.getElementById('summonBtn');
    const singleSummon = document.getElementById('singleSummon');
    const gachaBoard = document.getElementById('gachaBoard');

    // Update counter dots
    limitCounter.innerHTML = '';
    for (let i = 0; i < this.MAX_SUMMONS; i++) {
      const dot = document.createElement('div');
      dot.className = `limit-dot ${i < this.currentSummons ? 'used' : ''}`;
      limitCounter.appendChild(dot);
    }

    // Update summons left text
    const remaining = this.getRemainingSummons();
    summonsLeft.textContent = remaining;
    
    // Update button states
    const canSummon = this.canSummon() && window.securitySystem.isVerified;
    summonBtn.disabled = !canSummon;
    singleSummon.disabled = !canSummon;

    // Add/remove summon disabled class
    if (!canSummon && window.securitySystem.isVerified) {
      gachaBoard.classList.add('summon-disabled');
    } else {
      gachaBoard.classList.remove('summon-disabled');
    }

    // Show cooldown timer jika limit habis
    if (!this.canSummon()) {
      cooldownTimer.classList.add('show');
    } else {
      cooldownTimer.classList.remove('show');
    }
  }

  startCooldownTimer() {
    setInterval(() => {
      this.updateCooldownText();
    }, 1000);
  }

  updateCooldownText() {
    const cooldownText = document.getElementById('cooldownText');
    const timeUntilReset = this.getTimeUntilReset();
    
    const formatTime = (time) => time.toString().padStart(2, '0');
    const timeString = `${formatTime(timeUntilReset.hours)}:${formatTime(timeUntilReset.minutes)}:${formatTime(timeUntilReset.seconds)}`;
    
    cooldownText.textContent = `Resets in: ${timeString}`;
    
    // Auto reset ketika waktu habis
    if (timeUntilReset.hours === 0 && timeUntilReset.minutes === 0 && timeUntilReset.seconds === 0) {
      this.resetDailyLimits();
      this.updateUI();
      this.showRefreshNotification();
    }
  }

  showSummonNotification() {
    const remaining = this.getRemainingSummons();
    let message = '';
    
    if (remaining === 4) {
      message = '‚úÖ Summon successful! 4 summons remaining today.';
    } else if (remaining === 3) {
      message = '‚úÖ Summon successful! 3 summons remaining today.';
    } else if (remaining === 2) {
      message = '‚ö†Ô∏è 2 summons remaining today. Use them wisely!';
    } else if (remaining === 1) {
      message = '‚ö†Ô∏è Last summon remaining today!';
    } else if (remaining === 0) {
      message = 'üéØ Daily limit reached! Come back tomorrow for more summons.';
    }
    
    if (message) {
      showNotification(message);
    }
  }

  showRefreshNotification() {
    const refreshNotification = document.getElementById('refreshNotification');
    refreshNotification.classList.add('show');
    
    setTimeout(() => {
      refreshNotification.classList.remove('show');
    }, 5000);
  }

  getSummonStatus() {
    return {
      current: this.currentSummons,
      max: this.MAX_SUMMONS,
      remaining: this.getRemainingSummons(),
      canSummon: this.canSummon(),
      resetTime: this.resetTime
    };
  }
}

/* ---------------------- MODIFIED GACHA SYSTEM ---------------------- */
class GachaSystem {
  constructor() {
    this.panels = Array.from(document.querySelectorAll('.panel'));
    this.currentSlide = 0;
    this.totalSlides = this.panels.length;
    this.summonLimitSystem = new SummonLimitSystem();
    this.init();
  }

  init() {
    this.setupCarousel();
    this.setupGacha();
    this.setupBackground();
    this.updateSlider();
  }

  setupGacha() {
    const summonBtn = document.getElementById('summonBtn');
    const singleSummon = document.getElementById('singleSummon');
    const claimBtn = document.getElementById('claimBtn');
    const closeResult = document.getElementById('closeResult');
    const modeBtn = document.getElementById('modeBtn');

    summonBtn.addEventListener('click', (e) => {
      if (!this.checkSummonConditions()) return;
      this.performSummon(true);
    });

    singleSummon.addEventListener('click', (e) => {
      if (!this.checkSummonConditions()) return;
      this.performSummon(false);
    });

    claimBtn.addEventListener('click', async () => {
      const filename = claimBtn.dataset.filename;
      if (!filename) {
        showNotification('‚ùå No file available for download.');
        return;
      }
      await this.secureDownload(filename);
      this.closeResult();
    });

    closeResult.addEventListener('click', () => {
      this.closeResult();
    });

    // Mode switching
    let currentMode = 'showcase';
    modeBtn.addEventListener('click', () => {
      currentMode = currentMode === 'showcase' ? 'gacha' : 'showcase';
      modeBtn.textContent = `Mode: ${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)}`;
      this.setMode(currentMode);
    });
  }

  checkSummonConditions() {
    // Cek subscription
    if (!window.securitySystem.isVerified) {
      window.securitySystem.showVerificationModal();
      showNotification('üîí Subscription required for summoning');
      return false;
    }

    // Cek summon limit
    if (!this.summonLimitSystem.canSummon()) {
      showNotification('üéØ Daily summon limit reached! Come back tomorrow.');
      return false;
    }

    return true;
  }

  async performSummon(full = true) {
    const summonBtn = document.getElementById('summonBtn');
    const singleSummon = document.getElementById('singleSummon');
    const originalText = summonBtn.innerHTML;

    // Cek limit lagi sebelum memulai
    if (!this.summonLimitSystem.canSummon()) {
      showNotification('üéØ Daily summon limit reached!');
      return;
    }

    summonBtn.innerHTML = '<div class="spinner"></div> Loading...';
    summonBtn.disabled = true;
    singleSummon.disabled = true;

    try {
      const gtiles = Array.from(document.querySelectorAll('.gtiles .gtile'));
      let cycles = full ? 25 + Math.floor(Math.random() * 15) : 10 + Math.floor(Math.random() * 8);
      
      gtiles.forEach(t => t.classList.remove('sel'));
      
      for (let i = 0; i < cycles; i++) {
        const sel = gtiles[i % gtiles.length];
        sel.classList.add('sel');
        await sleep(50 + Math.floor(i * 1.5));
        if (i < cycles - 1) {
          sel.classList.remove('sel');
        }
      }

      const chosenRarity = this.chooseRarity();
      const winnerPanel = this.pickPanelByRarity(chosenRarity);
      
      await sleep(500);
      
      // Increment summon count setelah summon berhasil
      const summonSuccess = this.summonLimitSystem.incrementSummon();
      if (!summonSuccess) {
        showNotification('‚ùå Summon failed: Limit reached');
        return;
      }
      
      await this.revealPanel(winnerPanel);
      
    } catch (error) {
      console.error('Summon error:', error);
      showNotification('‚ùå Summon failed. Please try again.');
    } finally {
      summonBtn.innerHTML = 'SUMMON';
      summonBtn.disabled = !this.summonLimitSystem.canSummon() || !window.securitySystem.isVerified;
      singleSummon.disabled = !this.summonLimitSystem.canSummon() || !window.securitySystem.isVerified;
    }
  }

  async secureDownload(filename) {
    try {
      showNotification('üîÑ Generating secure download link...');
      
      // Simulate API call
      await sleep(1000);
      
      const downloadUrl = `mods/${filename}.zip`;
      const link = document.createElement('a');
      link.href = downloadUrl;
      link.download = `${filename}.zip`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showNotification('‚úÖ Download started!');
      return true;
    } catch (error) {
      console.error('Download error:', error);
      showNotification('‚ùå Download failed. Please try again.');
      return false;
    }
  }

  // ... (methods lainnya tetap sama seperti sebelumnya)
  setupCarousel() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    prevBtn.addEventListener('click', () => this.prevSlide());
    nextBtn.addEventListener('click', () => this.nextSlide());

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') this.prevSlide();
      if (e.key === 'ArrowRight') this.nextSlide();
    });

    this.panels.forEach((panel, index) => {
      panel.addEventListener('click', () => {
        this.goToSlide(index);
      });
    });
  }

  setupBackground() {
    const bgContainer = document.getElementById('bgContainer');
    const SLIDES = [
      'assets/backgrounds/bg1.jpg',
      'assets/backgrounds/bg2.jpg',
      'assets/backgrounds/bg3.jpg',
      'assets/backgrounds/bg4.jpg'
    ];

    if (SLIDES.length === 0) return;

    SLIDES.forEach((src, i) => {
      const slide = document.createElement('div');
      slide.className = 'bg-slide';
      slide.style.backgroundImage = `url(${src})`;
      if (i === 0) slide.classList.add('active');
      bgContainer.appendChild(slide);
    });

    let idx = 0;
    setInterval(() => {
      const slides = bgContainer.querySelectorAll('.bg-slide');
      if (!slides.length) return;
      slides[idx].classList.remove('active');
      idx = (idx + 1) % slides.length;
      slides[idx].classList.add('active');
    }, 6000);
  }

  updateSlider() {
    const panelWidth = 280;
    const gap = 28;
    const offset = -this.currentSlide * (panelWidth + gap);
    document.getElementById('carousel').style.transform = `translate3d(${offset}px, 0, 0)`;
    document.getElementById('slideCounter').textContent = `${this.currentSlide + 1}/${this.totalSlides}`;
    
    document.getElementById('prevBtn').disabled = this.currentSlide === 0;
    document.getElementById('nextBtn').disabled = this.currentSlide === this.totalSlides - 1;
    
    this.updateActivePanel();
  }

  updateActivePanel() {
    this.panels.forEach((panel, index) => {
      if (index === this.currentSlide) {
        panel.classList.add('active');
        const name = panel.dataset.name || 'Unknown';
        const rarity = panel.dataset.rarity || '';
        const description = panel.dataset.description || '';
        
        document.getElementById('heroName').textContent = name;
        document.getElementById('heroDesc').textContent = `${rarity} ‚Ä¢ ${description}`;
        
        const rarityGlow = {
          Mythic: 'rgba(243, 212, 143, 0.4)',
          Legendary: 'rgba(155, 123, 255, 0.4)',
          Elite: 'rgba(57, 210, 255, 0.4)',
          Common: 'rgba(148, 166, 191, 0.4)'
        };
        panel.style.setProperty('--aura-glow', rarityGlow[rarity] || 'rgba(57,210,255,0.3)');
      } else {
        panel.classList.remove('active');
      }
    });
  }

  goToSlide(index) {
    this.currentSlide = clamp(index, 0, this.totalSlides - 1);
    this.updateSlider();
  }

  nextSlide() {
    if (this.currentSlide < this.totalSlides - 1) {
      this.currentSlide++;
      this.updateSlider();
    }
  }

  prevSlide() {
    if (this.currentSlide > 0) {
      this.currentSlide--;
      this.updateSlider();
    }
  }

  chooseRarity() {
    const rarityRates = {
      Mythic: 0.02,
      Legendary: 0.08,
      Elite: 0.2,
      Common: 0.7
    };

    const r = Math.random();
    let sum = 0;
    for (const [rarity, rate] of Object.entries(rarityRates)) {
      sum += rate;
      if (r <= sum) return rarity;
    }
    return 'Common';
  }

  pickPanelByRarity(rarity) {
    const matches = this.panels.filter(p => 
      (p.dataset.rarity || '').toLowerCase() === rarity.toLowerCase()
    );
    if (matches.length > 0) {
      return matches[Math.floor(Math.random() * matches.length)];
    }
    return this.panels[Math.floor(Math.random() * this.panels.length)];
  }

  async revealPanel(panel) {
    this.panels.forEach(x => x.classList.remove('sel'));
    panel.classList.add('sel');
    
    const name = panel.dataset.name || 'Unknown';
    const rarity = panel.dataset.rarity || 'Unknown';
    const description = panel.dataset.description || '';
    const filename = panel.dataset.file || '';
    
    document.getElementById('resultTitle').textContent = `${rarity} ‚Ä¢ You Obtained ${name}`;
    document.getElementById('resultText').textContent = `${description} - Secure download ready!`;
    document.getElementById('claimBtn').dataset.filename = filename;
    
    const rarityGlow = {
      Mythic: 'rgba(243, 212, 143, 0.4)',
      Legendary: 'rgba(155, 123, 255, 0.4)',
      Elite: 'rgba(57, 210, 255, 0.4)',
      Common: 'rgba(148, 166, 191, 0.4)'
    };
    
    const resultCard = document.querySelector('.result-card');
    resultCard.style.setProperty('--result-glow', rarityGlow[rarity] || 'rgba(57,210,255,0.2)');
    
    document.getElementById('resultOverlay').classList.add('open');
    document.getElementById('resultOverlay').setAttribute('aria-hidden', 'false');
  }

  closeResult() {
    document.getElementById('resultOverlay').classList.remove('open');
    document.getElementById('resultOverlay').setAttribute('aria-hidden', 'true');
    this.panels.forEach(x => x.classList.remove('sel'));
  }

  setMode(mode) {
    const showcaseWrap = document.getElementById('showcaseWrap');
    const gachaBoard = document.getElementById('gachaBoard');
    const heroSpot = document.getElementById('heroSpot');

    if (mode === 'showcase') {
      showcaseWrap.style.display = 'flex';
      gachaBoard.classList.add('hide');
      heroSpot.style.display = 'flex';
    } else {
      showcaseWrap.style.display = 'none';
      gachaBoard.classList.remove('hide');
      heroSpot.style.display = 'none';
    }
  }
}

/* ---------------------- UTILITY FUNCTIONS ---------------------- */
function clamp(v, a=0, b=1){ return Math.max(a, Math.min(b, v)); }
function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

function handleImageError(img) {
  img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDgxODI5Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjMzlkMmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgTm90IEZvdW5kPC90ZXh0Pjwvc3ZnPg==';
  img.alt = 'Gambar tidak tersedia';
}

function showNotification(message, duration = 3000) {
  const notification = document.getElementById('notification');
  if (!notification) return;
  
  notification.textContent = message;
  notification.classList.add('show');
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, duration);
}

/* ---------------------- INITIALIZATION ---------------------- */
document.addEventListener('DOMContentLoaded', function() {
  // Initialize systems
  window.securitySystem = new SubscriptionSecurity();
  window.gachaSystem = new GachaSystem();
  
  // Setup background music
  const bgMusic = document.getElementById('bgMusic');
  document.addEventListener('click', function() {
    bgMusic.play().catch(() => {});
  }, { once: true });

  // Add error handlers to images
  document.querySelectorAll('img').forEach(img => {
    img.addEventListener('error', () => handleImageError(img));
  });

  console.log('üéÆ Gacha System with Summon Limits Initialized');
});

// Subscription Security Class (tetap sama seperti sebelumnya)
class SubscriptionSecurity {
  constructor() {
    this.attempts = 0;
    this.isVerified = false;
    this.init();
  }

  init() {
    this.checkVerification();
    this.updateUI();
  }

  checkVerification() {
    // Simplified verification check
    const verified = localStorage.getItem('gacha_sub_verified');
    const sessionStart = localStorage.getItem('gacha_session_start');
    
    if (!verified || !sessionStart) {
      this.isVerified = false;
      return;
    }
    
    const sessionAge = Date.now() - parseInt(sessionStart);
    const SESSION_DURATION = 2 * 60 * 60 * 1000; // 2 hours
    
    this.isVerified = sessionAge < SESSION_DURATION;
  }

  updateUI() {
    const subBadge = document.getElementById('subBadge');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const enableBtn = document.getElementById('enableBtn');

    if (this.isVerified) {
      subBadge.style.display = 'inline-flex';
      statusDot.className = 'status-dot verified';
      statusText.textContent = 'Verified ‚úì';
      enableBtn.style.display = 'none';
    } else {
      subBadge.style.display = 'none';
      statusDot.className = 'status-dot';
      statusText.textContent = 'Verification Required';
      enableBtn.style.display = 'block';
    }
  }

  // ... (methods lainnya untuk modal verification)
  showVerificationModal() {
    const modal = document.getElementById('verificationModal');
    if (modal) modal.classList.add('active');
  }
}
</script>
</html>
