<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Cyber Neon Gacha</title>
  <style>
    :root {
      --bg: #020611;
      --accent: linear-gradient(90deg,#00f5ff,#0066ff);
      --text: #e6eef8;
      --muted: #8ba2b8;
      --card: rgba(10,20,40,0.8);
      --glow: 0 0 20px #00eaff, 0 0 40px #007fff, inset 0 0 10px #00eaff;
    }

    * { box-sizing: border-box; }
    html,body {
      margin:0; padding:0;
      font-family: 'Orbitron', sans-serif;
      background: var(--bg);
      color: var(--text);
      height:100%;
      overflow-x:hidden;
    }

    body::before {
      content:"";
      position:fixed; inset:0;
      background:url('assets/bg.jpg') center/cover no-repeat;
      filter:brightness(0.3) blur(4px);
      z-index:-2;
    }

    body::after {
      content:"";
      position:fixed; inset:0;
      background:radial-gradient(circle at 20% 30%, rgba(0,255,255,0.08), transparent 70%);
      z-index:-1;
    }

    .app {
      max-width:1200px;
      margin:50px auto;
      padding:30px;
      background:rgba(0,10,25,0.6);
      border-radius:20px;
      box-shadow:var(--glow);
      border:1px solid rgba(0,255,255,0.2);
      backdrop-filter:blur(8px);
      animation:fadeIn 1.2s ease-out;
    }

    header {display:flex;align-items:center;gap:16px;margin-bottom:18px;}
    .logo {
      width:60px;height:60px;border-radius:12px;
      background:var(--accent);
      color:#000;
      font-weight:900;
      display:flex;align-items:center;justify-content:center;
      text-shadow:0 0 10px #00f5ff;
      box-shadow:var(--glow);
    }

    h1 {margin:0;font-size:24px;}
    p.lead {margin:4px 0 0;color:var(--muted);font-size:14px;}

    .controls {margin-left:auto;display:flex;gap:12px;}
    .btn {
      border:none;
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      transition:all .3s;
      color:#fff;
      background:var(--accent);
      box-shadow:0 0 10px #00eaff;
    }
    .btn.ghost {
      background:transparent;
      border:1px solid #00bfff;
      color:#00eaff;
    }
    .btn:hover {
      transform:scale(1.05);
      box-shadow:0 0 20px #00eaff;
    }

    .grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:16px;}
    .card {
      background:var(--card);
      border-radius:10px;
      overflow:hidden;
      border:1px solid rgba(0,255,255,0.15);
      transition:all .3s;
      box-shadow:0 0 12px rgba(0,255,255,0.1);
    }
    .card img {width:100%;height:110px;object-fit:cover;}
    .card .label {text-align:center;font-weight:700;padding:8px;}
    .card:hover {
      transform:translateY(-4px);
      box-shadow:var(--glow);
    }

    .highlight {box-shadow:0 0 25px #00ffff, inset 0 0 15px #00eaff;}

    .spin-btn {
      width:100%;
      padding:16px;
      font-size:18px;
      border:none;
      border-radius:12px;
      margin-top:20px;
      font-weight:800;
      background:var(--accent);
      color:#001;
      cursor:pointer;
      box-shadow:var(--glow);
    }

    .muted {color:var(--muted);}
    .modal {
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.6);z-index:999;
    }
    .modal.open {display:flex;}
    .modal .box {
      background:#04121a;
      padding:24px;
      border-radius:14px;
      border:1px solid #00eaff;
      box-shadow:var(--glow);
      text-align:center;
      animation:pop .4s ease-out;
    }
    @keyframes fadeIn {from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:none;}}
    @keyframes pop {from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}

    /* Volume button */
    #volumeToggle {
      position:fixed;bottom:16px;right:20px;
      background:rgba(0,255,255,0.1);
      border:1px solid rgba(0,255,255,0.3);
      border-radius:50%;
      width:44px;height:44px;
      display:flex;align-items:center;justify-content:center;
      font-size:20px;
      cursor:pointer;
      color:#00eaff;
      box-shadow:0 0 10px #00eaff;
    }
    #volumeToggle:hover {background:rgba(0,255,255,0.25);}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">G</div>
      <div>
        <h1>Cyber Neon Gacha</h1>
        <p class="lead">Spin for epic mod drops â€” subscribe to unlock!</p>
      </div>
      <div class="controls">
        <button class="btn ghost" id="btnSubscribe">Subscribe</button>
        <button class="btn" id="btnGacha">Gacha</button>
      </div>
    </header>

    <div class="grid" id="cards">
      <div class="card" data-index="0"><img src="assets/img1.png"><div class="label">Mod A (SSR)</div></div>
      <div class="card" data-index="1"><img src="assets/img2.png"><div class="label">Mod B (SR)</div></div>
      <div class="card" data-index="2"><img src="assets/img3.png"><div class="label">Mod C (R)</div></div>
      <div class="card" data-index="3"><img src="assets/img4.png"><div class="label">Mod D (SR)</div></div>
      <div class="card" data-index="4"><img src="assets/img5.png"><div class="label">Mod E (R)</div></div>
      <div class="card" data-index="5"><img src="assets/img6.png"><div class="label">Mod F (SSR)</div></div>
    </div>

    <button id="spinBtn" class="spin-btn">ðŸŽ° SPIN</button>
  </div>

  <div class="modal" id="modalResult">
    <div class="box">
      <h2 id="resultTitle">You Won!</h2>
      <button id="downloadBtn" class="btn">Download</button>
    </div>
  </div>

  <button id="volumeToggle">ðŸ”ˆ</button>
  <audio id="bgm" src="assets/bg.mp3" loop></audio>

  <script>
    const spinBtn = document.getElementById('spinBtn');
    const cards = Array.from(document.querySelectorAll('.card'));
    const modal = document.getElementById('modalResult');
    const resultTitle = document.getElementById('resultTitle');
    const downloadBtn = document.getElementById('downloadBtn');
    const bgm = document.getElementById('bgm');
    const volumeToggle = document.getElementById('volumeToggle');

    let playing = false;

    function playBGM() {
      if (!playing) {
        bgm.volume = 0.5;
        bgm.play().catch(()=>{});
        playing = true;
      }
    }

    volumeToggle.onclick = () => {
      if (bgm.muted) {
        bgm.muted = false;
        volumeToggle.textContent = 'ðŸ”ˆ';
      } else {
        bgm.muted = true;
        volumeToggle.textContent = 'ðŸ”‡';
      }
    };

    async function spin() {
      playBGM();
      let duration = 2500;
      let start = Date.now();
      let last = -1;
      const final = Math.floor(Math.random()*cards.length);

      function animate() {
        let now = Date.now();
        if (now - start < duration) {
          let i = Math.floor((now/100)%cards.length);
          if (i !== last) {
            cards.forEach(c=>c.classList.remove('highlight'));
            cards[i].classList.add('highlight');
            last = i;
          }
          requestAnimationFrame(animate);
        } else {
          cards.forEach(c=>c.classList.remove('highlight'));
          cards[final].classList.add('highlight');
          showResult(final);
        }
      }
      animate();
    }

    async function showResult(idx) {
      const name = cards[idx].querySelector('.label').textContent;
      resultTitle.textContent = `You won ${name}!`;
      modal.classList.add('open');
      // Fetch one-time link from API
      const res = await fetch(`/api/download?id=${idx}`);
      const data = await res.json();
      downloadBtn.onclick = ()=>window.open(data.url,'_blank');
    }

    modal.addEventListener('click',e=>{if(e.target===modal)modal.classList.remove('open');});
    spinBtn.addEventListener('click',spin);
  </script>
</body>
</html>
