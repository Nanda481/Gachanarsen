<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gacha Showcase — Dark Stylish</title>
<meta name="description" content="Gacha Showcase - 8 diagonal characters, aura per rarity, single-file ready.">
<style>
  /* ========== THEME ========== */
  :root{
    --bg:#06050a;
    --panel: rgba(10,8,15,0.6);
    --muted:#9aa4b2;
    --accent:#7c3aed;
    --glass: rgba(255,255,255,0.03);

    /* aura colors */
    --aur-ur: rgba(187,134,252,0.18); /* purple */
    --aur-ssr: rgba(255,214,92,0.16); /* yellow */
    --aur-sr: rgba(96,165,250,0.14);  /* blue */
    --aur-r: rgba(52,211,153,0.12);   /* green */
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    background:
      radial-gradient(800px 300px at 20% 10%, rgba(124,58,237,0.07), transparent),
      linear-gradient(180deg,#030205,#07040a 60%);
    color:#e9eef8;
    overflow-x:hidden;
  }

  /* container */
  .wrap{max-width:1400px;margin:28px auto;padding:18px;position:relative}

  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:14px}
  #logo{width:64px;height:64px;border-radius:12px;background:var(--panel);display:flex;align-items:center;justify-content:center;font-weight:800}
  h1{margin:0;font-size:18px}
  .sub{color:var(--muted);font-size:13px}

  .actions{display:flex;gap:10px;align-items:center}
  .btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:800;background:transparent;color:inherit}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#5b21b6);color:white}
  .btn.ghost{border:1px solid rgba(255,255,255,0.06)}
  .spins{font-weight:800;color:var(--muted)}

  /* showcase area */
  .showcase-wrap{margin-top:24px;position:relative;height:520px;display:flex;align-items:center;justify-content:center}
  .showcase-stage{position:relative;width:100%;max-width:1200px;height:480px;display:flex;align-items:center;justify-content:center;overflow:visible}

  /* each diagonal panel */
  .panel{
    position:absolute;
    width:220px;
    height:420px;
    transform-origin:center;
    border-radius:8px;
    overflow:visible;
    transition:transform .42s cubic-bezier(.2,.9,.18,1), box-shadow .3s;
    filter:drop-shadow(0 18px 40px rgba(0,0,0,0.6));
    cursor:pointer;
  }
  .panel .img{
    position:absolute;left:0;top:0;width:100%;height:100%;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,0.02);
    transform: skewX(-18deg) translateZ(0); /* diagonal slant */
  }
  .panel .label{
    position:absolute;left:10px;bottom:18px;color:#fff;font-weight:800;text-shadow:0 6px 30px rgba(0,0,0,0.6);transform:skewX(-18deg);
    font-size:18px;letter-spacing:2px;
  }

  /* aura overlay */
  .aura{
    position:absolute;inset: -16px; border-radius:12px; pointer-events:none; mix-blend-mode:screen;
    background: radial-gradient(400px 120px at 50% 30%, rgba(255,255,255,0.02), transparent);
    opacity:0; transition:opacity .35s, transform .6s;
    filter: blur(18px);
  }

  /* positioning 8 panels horizontally with diagonal stagger */
  /* We'll place them using nth-child positions via container .panels */
  .panels{position:relative;width:100%;height:100%;display:block}

  /* example positions (centered) */
  /* index 0 .. 7 — left to right */
  .panels .panel.p0{left:8%; top:36%; transform: rotate(-12deg) scale(.86);}
  .panels .panel.p1{left:18%; top:18%; transform: rotate(-10deg) scale(.9);}
  .panels .panel.p2{left:30%; top:6%;  transform: rotate(-8deg) scale(1.02);}
  .panels .panel.p3{left:44%; top:2%;  transform: rotate(-6deg) scale(1.18);} /* center-left big */
  .panels .panel.p4{left:58%; top:8%;  transform: rotate(-4deg) scale(1.28);} /* center big */
  .panels .panel.p5{left:72%; top:18%; transform: rotate(-2deg) scale(1.02);}
  .panels .panel.p6{left:82%; top:32%; transform: rotate(0deg)  scale(.94);}
  .panels .panel.p7{left:90%; top:44%; transform: rotate(2deg)  scale(.82);}

  /* hover/enlarge effect */
  .panel:hover{transform:translateY(-12px) scale(1.06) rotate(0deg) !important; z-index:40}
  .panel:hover .aura{opacity:1; transform: scale(1.08)}
  .panel.focus{transform:scale(1.22) translateY(-6px); z-index:50}
  .panel.focus .aura{opacity:1; transform:scale(1.18)}

  /* shimmer overlay for higher rarity */
  .shimmer{
    position:absolute;inset:0;border-radius:8px;pointer-events:none;mix-blend-mode:overlay;opacity:0;
    background:linear-gradient(120deg, rgba(255,255,255,0.06), rgba(255,255,255,0.00) 40%, rgba(255,255,255,0.06) 60%, rgba(255,255,255,0.00));
    transform: skewX(-18deg) translateX(-120%);
    transition:opacity .45s, transform 1.2s;
  }
  .panel.focus .shimmer{opacity:1; transform: skewX(-18deg) translateX(0%);}

  /* controls area */
  .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:18px}
  #spinBtn{padding:12px 26px;border-radius:999px;border:0;background:linear-gradient(90deg,var(--accent),#4c1d95);color:#fff;font-weight:900;cursor:pointer}
  #spinBtn.disabled{opacity:.55;pointer-events:none}

  /* preview overlay (click) */
  .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6));z-index:9999;opacity:0;pointer-events:none;transition:opacity .18s}
  .overlay.show{opacity:1;pointer-events:auto}
  .preview-card{width:880px;max-width:94%;background:linear-gradient(180deg, rgba(12,10,16,0.98), rgba(6,6,8,0.98));padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:18px;align-items:center}
  .preview-art{width:48%; max-width:420px;border-radius:8px;object-fit:cover;filter:drop-shadow(0 18px 60px rgba(0,0,0,0.6))}
  .preview-info{flex:1;color:var(--muted)}
  .preview-name{font-size:28px;font-weight:900;color:#fff;margin-bottom:8px}
  .preview-desc{color:var(--muted);margin-bottom:14px}
  .preview-actions{display:flex;gap:10px;align-items:center}

  /* result card */
  .result-popup{position:fixed;left:50%;top:72%;transform:translate(-50%,-50%);z-index:10001;background:linear-gradient(180deg, rgba(12,10,16,0.96), rgba(6,6,8,0.96));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);min-width:320px;display:flex;flex-direction:column;align-items:center;gap:10px;box-shadow:0 20px 60px rgba(0,0,0,0.6)}
  .result-name{font-weight:900;color:#fff;font-size:18px}
  .result-rarity{padding:6px 10px;border-radius:8px;font-weight:900;color:#111}

  /* small screens */
  @media(max-width:980px){
    .panel{width:150px;height:300px}
    .panels .panel.p0{left:4%;top:36%}
    .panels .panel.p1{left:14%;top:26%}
    .panels .panel.p2{left:27%;top:14%}
    .panels .panel.p3{left:40%;top:8%}
    .panels .panel.p4{left:56%;top:12%}
    .panels .panel.p5{left:70%;top:24%}
    .panels .panel.p6{left:82%;top:36%}
    .panels .panel.p7{left:90%;top:46%}
    .preview-card{flex-direction:column;align-items:center}
    .preview-art{width:88%}
  }

  /* utility */
  .muted{color:var(--muted)}
  a { color:inherit; text-decoration:none }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div id="logo">LOGO</div>
      <div>
        <h1>Gacha Showcase</h1>
        <div class="sub">Dark stylish • 8 characters • click to preview • Subscribe -> get 5 spins</div>
      </div>
    </div>

    <div class="actions">
      <a id="subscribeBtn" class="btn ghost" target="_blank">Subscribe</a>
      <div class="spins">Spins left: <strong id="spinsCount">0</strong></div>
      <button id="enterBtn" class="btn primary disabled" disabled>Enter Gacha</button>
    </div>
  </header>

  <section class="showcase-wrap">
    <div class="showcase-stage">
      <div class="panels" id="panels">
        <!-- panels injected by JS -->
      </div>
    </div>
  </section>

  <div class="controls">
    <button id="spinBtn" class="btn primary disabled" disabled>SPIN</button>
  </div>

</div>

<!-- preview overlay -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="preview-card" role="dialog" aria-modal="true">
    <img id="previewArt" class="preview-art" src="" alt="preview">
    <div class="preview-info">
      <div id="previewTitle" class="preview-name">Name</div>
      <div id="previewRarity" class="preview-desc muted">Rarity</div>
      <div class="preview-actions">
        <button id="previewClose" class="btn ghost">Close</button>
        <button id="previewMore" class="btn primary">More Details</button>
      </div>
    </div>
  </div>
</div>

<!-- result popup -->
<div id="resultPopup" class="result-popup" style="display:none">
  <div id="resultName" class="result-name"></div>
  <div id="resultRarity" class="result-rarity"></div>
  <img id="resultArt" src="" alt="" style="max-width:320px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.6)">
  <button id="downloadBtn" class="btn primary" style="margin-top:8px">Download Mod</button>
</div>

<!-- audio -->
<audio id="bgm" loop crossorigin="anonymous"></audio>
<audio id="sfxSpin"></audio>
<aio id="sfxUR"></aio>
<aio id="sfxSSR"></aio>

<script>
/* =========================
   CONFIG - update assets in /assets/
   ========================= */
const CONFIG = {
  YT_CHANNEL: 'https://youtube.com/@ChidorayMods', // change to your channel
  START_SPINS: 5,
  MUSIC: 'assets/music/bgm.mp3', // put your mp3 here for reliable autoplay
  SFX: {
    spin: 'assets/sfx/spin.mp3',
    ur: 'assets/sfx/ur.mp3',
    ssr: 'assets/sfx/ssr.mp3'
  },
  // 8 characters (showcase). replace images & preview & file links with your assets
  CHARACTERS: [
    { id:'c01', name:'Celestia', img:'assets/char1.jpg', preview:'assets/char1_preview.png', file:'https://example.com/celestia.zip', rarity:'SSR' },
    { id:'c02', name:'Sibylle',  img:'assets/char2.jpg', preview:'assets/char2_preview.png', file:'https://example.com/sibylle.zip', rarity:'UR' },
    { id:'c03', name:'Fushu',    img:'assets/char3.jpg', preview:'assets/char3_preview.png', file:'https://example.com/fushu.zip', rarity:'SR' },
    { id:'c04', name:'Berenica', img:'assets/char4.jpg', preview:'assets/char4_preview.png', file:'https://example.com/berenica.zip', rarity:'R' },
    { id:'c05', name:'Rebecca',  img:'assets/char5.jpg', preview:'assets/char5_preview.png', file:'https://example.com/rebecca.zip', rarity:'SR' },
    { id:'c06', name:'Noctis',   img:'assets/char6.jpg', preview:'assets/char6_preview.png', file:'https://example.com/noctis.zip', rarity:'SSR' },
    { id:'c07', name:'Lyra',     img:'assets/char7.jpg', preview:'assets/char7_preview.png', file:'https://example.com/lyra.zip', rarity:'R' },
    { id:'c08', name:'Kappa',    img:'assets/char8.jpg', preview:'assets/char8_preview.png', file:'https://example.com/kappa.zip', rarity:'R' }
  ],
  // weights for gacha rarity selection
  RARITY_WEIGHTS: { UR:1, SSR:8, SR:20, R:71 }
};
/* ========================= */

/* Elements */
const panelsEl = document.getElementById('panels');
const subscribeBtn = document.getElementById('subscribeBtn');
const enterBtn = document.getElementById('enterBtn');
const spinBtn = document.getElementById('spinBtn');
const spinsCountEl = document.getElementById('spinsCount');
const overlay = document.getElementById('overlay');
const previewArt = document.getElementById('previewArt');
const previewTitle = document.getElementById('previewTitle');
const previewRarity = document.getElementById('previewRarity');
const previewClose = document.getElementById('previewClose');
const previewMore = document.getElementById('previewMore');
const resultPopup = document.getElementById('resultPopup');
const resultName = document.getElementById('resultName');
const resultRarity = document.getElementById('resultRarity');
const resultArt = document.getElementById('resultArt');
const downloadBtn = document.getElementById('downloadBtn');
const bgm = document.getElementById('bgm');
const sfxSpin = document.getElementById('sfxSpin');
const sfxUR = document.getElementById('sfxUR');
const sfxSSR = document.getElementById('sfxSSR');

let spinsLeft = 0;
const STORAGE_SPINS = 'gacha_spins_v_final';
const STORAGE_SUB = 'gacha_sub_v_final';
let isSpinning = false;

/* Build panels */
function buildPanels(){
  panelsEl.innerHTML = '';
  CONFIG.CHARACTERS.forEach((c, i)=>{
    const d = document.createElement('div');
    d.className = `panel p${i}`;
    d.dataset.idx = i;
    // aura element
    const aura = document.createElement('div');
    aura.className = 'aura';
    // color by rarity
    const rar = (c.rarity||'R').toUpperCase();
    if(rar==='UR') aura.style.background = 'radial-gradient(300px 120px at 50% 20%, var(--aur-ur), transparent)';
    else if(rar==='SSR') aura.style.background = 'radial-gradient(300px 120px at 50% 20%, var(--aur-ssr), transparent)';
    else if(rar==='SR') aura.style.background = 'radial-gradient(300px 120px at 50% 20%, var(--aur-sr), transparent)';
    else aura.style.background = 'radial-gradient(300px 120px at 50% 20%, var(--aur-r), transparent)';

    // image element
    const img = document.createElement('img');
    img.className = 'img';
    img.src = c.img;
    img.alt = c.name;

    const label = document.createElement('div');
    label.className = 'label';
    label.textContent = c.name;

    const shimmer = document.createElement('div');
    shimmer.className = 'shimmer';

    d.appendChild(aura);
    d.appendChild(img);
    d.appendChild(shimmer);
    d.appendChild(label);

    // click -> open preview (no download)
    d.addEventListener('click', (ev)=>{
      openPreview(i);
    });

    panelsEl.appendChild(d);
  });
}

/* Preview logic */
function openPreview(idx){
  const c = CONFIG.CHARACTERS[idx];
  previewArt.src = c.preview || c.img;
  previewTitle.textContent = c.name;
  previewRarity.textContent = (c.rarity||'R').toUpperCase();
  // rarity color
  previewRarity.style.color = '#fff';
  if(c.rarity==='UR') previewRarity.style.background = 'linear-gradient(90deg,var(--aur-ur),#8b5cf6)';
  else if(c.rarity==='SSR') previewRarity.style.background = 'linear-gradient(90deg,var(--aur-ssr),#f59e0b)';
  else if(c.rarity==='SR') previewRarity.style.background = 'linear-gradient(90deg,var(--aur-sr),#60a5fa)';
  else previewRarity.style.background = 'linear-gradient(90deg,var(--aur-r),#34d399)';
  previewRarity.style.padding = '6px 10px';
  previewRarity.style.borderRadius = '8px';
  overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');

  // focus the clicked panel visually
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('focus'));
  const panel = document.querySelector(`.panel.p${idx}`);
  if(panel) panel.classList.add('focus');

  // previewMore opens more (here it could open external details page)
  previewMore.onclick = ()=>{ window.open(c.file,'_blank'); }; // or point to details page
}

/* close preview - delegation */
document.addEventListener('click', (e)=>{
  if(e.target === overlay || e.target === previewClose) {
    overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true');
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('focus'));
  }
});

/* Subscribe + spins */
subscribeBtn.addEventListener('click', ()=>{
  localStorage.setItem(STORAGE_SUB, Date.now());
  spinsLeft = CONFIG.START_SPINS;
  localStorage.setItem(STORAGE_SPINS, spinsLeft);
  document.getElementById('spinsCount').textContent = spinsLeft;
  unlockGacha();
  // open channel
  setTimeout(()=>{ try{ window.open(subscribeBtn.href || '#', '_blank'); }catch(e){} }, 60);
});

/* unlock gacha */
function unlockGacha(){
  enterBtn.disabled = false; enterBtn.classList.remove('disabled');
  spinBtn.disabled = false; spinBtn.classList.remove('disabled');
  document.getElementById('spinsCount').textContent = spinsLeft;
}

/* Enter button scrolls to showcase and attempts to play bgm */
enterBtn.addEventListener('click', ()=> {
  document.querySelector('.showcase-stage').scrollIntoView({behavior:'smooth', block:'center'});
  bgm.play().catch(()=>{});
});

/* Spin logic - weighted rarity pick and pick random char with that rarity */
function weightedPick(weights){
  const arr = Object.entries(weights);
  let total=0; arr.forEach(([k,v])=> total+=v);
  let r=Math.random()*total;
  for(const [k,v] of arr){
    if(r < v) return k;
    r -= v;
  }
  return arr[arr.length-1][0];
}
function pickCharacterByRarity(rarity){
  const arr = CONFIG.CHARACTERS.filter(c => (c.rarity||'R').toUpperCase() === rarity.toUpperCase());
  if(!arr.length) return CONFIG.CHARACTERS[Math.floor(Math.random()*CONFIG.CHARACTERS.length)];
  return arr[Math.floor(Math.random()*arr.length)];
}

/* play sfx helper */
function playSfx(src){
  if(!src) return;
  const a = new Audio(src);
  a.volume = 0.9;
  a.play().catch(()=>{});
}

/* Do spin */
spinBtn.addEventListener('click', ()=>{
  if(isSpinning) return;
  if(spinsLeft <= 0){
    alert('No spins left. Click Subscribe to get spins.');
    return;
  }
  isSpinning = true;
  // spin sound
  playSfx(CONFIG.SFX.spin);

  // determine rarity & character
  const rarity = weightedPick(CONFIG.RARITY_WEIGHTS);
  const chosen = pickCharacterByRarity(rarity);

  // animate highlight around panels: simple cycle effect ending on chosen panel
  const panels = Array.from(document.querySelectorAll('.panel'));
  // find an index where panel corresponds to chosen char (we mapped sequentially)
  let targetIndex = CONFIG.CHARACTERS.findIndex(c => c.id === chosen.id);
  if(targetIndex < 0) targetIndex = Math.floor(Math.random()*panels.length);

  const totalLoops = 3 + Math.floor(Math.random()*3);
  const totalSteps = totalLoops * panels.length + targetIndex;
  let step = 0;
  let interval = 80;

  const runStep = ()=>{
    const idx = step % panels.length;
    panels.forEach(p => { p.style.transform = p.style.transform.replace(/scale\([0-9.]+\)/,''); p.style.zIndex = ''; });
    const active = panels[idx];
    if(active){
      active.style.transform = active.style.transform + ' scale(1.06)';
      active.style.zIndex = 60;
    }
    step++;
    if(step <= totalSteps){
      interval = Math.min(500, interval * 1.06);
      setTimeout(runStep, interval);
    } else {
      // finish
      setTimeout(()=>{
        panels.forEach(p => { p.style.transform = p.style.transform.replace(/scale\([0-9.]+\)/,''); p.style.zIndex = ''; });
        onSpinFinish(chosen, targetIndex, rarity);
        isSpinning = false;
      }, 200);
    }
  };
  runStep();
});

function onSpinFinish(char, panelIndex, rarity){
  // decrement spins
  spinsLeft = Math.max(0, spinsLeft - 1);
  localStorage.setItem(STORAGE_SPINS, spinsLeft);
  spinsCountEl.textContent = spinsLeft;

  // set result popup content
  resultName.textContent = char.name;
  resultArt.src = char.preview || char.img;
  resultRarity.textContent = rarity;
  if(rarity === 'UR'){ resultRarity.style.background = 'linear-gradient(90deg,var(--aur-ur),#8b5cf6)'; resultRarity.style.color='#fff'; playSfx(CONFIG.SFX.ur); }
  else if(rarity === 'SSR'){ resultRarity.style.background = 'linear-gradient(90deg,var(--aur-ssr),#f59e0b)'; resultRarity.style.color='#111'; playSfx(CONFIG.SFX.ssr); }
  else if(rarity === 'SR'){ resultRarity.style.background = 'linear-gradient(90deg,var(--aur-sr),#60a5fa)'; resultRarity.style.color='#fff'; }
  else { resultRarity.style.background = 'linear-gradient(90deg,var(--aur-r),#34d399)'; resultRarity.style.color='#04251a'; }

  // show popup
  resultPopup.style.display = 'flex';
  resultPopup.style.opacity = '1';
  downloadBtn.onclick = ()=> window.open(char.file, '_blank');
  // highlight the panel slightly
  const p = document.querySelector(`.panel.p${panelIndex}`);
  if(p){
    p.classList.add('focus');
    setTimeout(()=> p.classList.remove('focus'), 1400);
  }
  // auto-hide result after some time (optional)
  setTimeout(()=>{ if(resultPopup) resultPopup.style.display = 'none'; }, 12000);
}

/* load saved spins */
function loadState(){
  const s = parseInt(localStorage.getItem(STORAGE_SPINS) || '0',10);
  spinsLeft = isNaN(s) ? 0 : s;
  spinsCountEl.textContent = spinsLeft;
  if(localStorage.getItem(STORAGE_SUB)){
    unlockGacha();
  }
}

/* Initialize audio and panels */
function init(){
  // set subscribe link
  subscribeBtn.href = CONFIG.YT_CHANNEL;
  // bgm
  bgm.src = CONFIG.MUSIC;
  bgm.volume = 0.6;
  // try autoplay when possible (browsers might block until interaction)
  bgm.play().catch(()=>{});
  // prebuild panels
  buildPanels();
  loadState();
}
init();

/* small UX: click center to play music if blocked */
document.addEventListener('click', ()=>{ if(bgm && bgm.paused) bgm.play().catch(()=>{}); });

/* keyboard: space to spin */
window.addEventListener('keydown', (e)=>{ if(e.code === 'Space'){ e.preventDefault(); if(!isSpinning && spinsLeft>0) document.getElementById('spinBtn').click(); } });

/* expose for debugging */
window.GACHA_FINAL = {CONFIG};
</script>
</body>
</html>
