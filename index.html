<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gacha Gallery — Ungu Neon</title>
<style>
  :root{
    --bg:#06050b;
    --card:rgba(18,8,30,0.62);
    --accent:#a855f7;
    --neon:#caa7ff;
    --muted:#9aa4b2;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:var(--bg);
    color:#eef2ff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
  }

  /* LAYOUT */
  .wrap{max-width:1200px;margin:28px auto;padding:18px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .brand{display:flex;gap:12px;align-items:center}
  #logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;font-weight:800}
  h1{margin:0;font-size:20px}
  .sub{color:var(--muted);font-size:13px}

  .actions{display:flex;gap:10px;align-items:center}
  a.btn, button.btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
  a.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;text-decoration:none}
  button.primary{background:linear-gradient(90deg,var(--accent),#6d28d9);color:white}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

  /* GALLERY of banners */
  .gallery{display:grid;grid-template-columns:repeat(10,1fr);gap:10px;margin-top:18px}
  .banner{background:var(--card);border-radius:12px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:transform .12s, box-shadow .12s}
  .banner:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(168,85,247,0.12)}
  .banner img{width:100%;height:64px;object-fit:cover;border-radius:8px}
  .banner .bname{margin-top:8px;font-size:12px;text-align:center;color:var(--neon);font-weight:700}

  /* VIEWPORT (slot/track) */
  .arena{margin-top:26px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02)}
  .viewport{width:100%;height:170px;overflow:hidden;border-radius:12px;position:relative;background:linear-gradient(90deg, rgba(5,3,12,0.6), rgba(10,6,20,0.5));margin-top:8px}
  .track{position:absolute;left:0;top:0;height:100%;display:flex;align-items:center;gap:14px;padding:0 40px;will-change:transform}
  .card{width:160px;height:140px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02)}
  .card img{max-width:86%;max-height:72%;border-radius:8px}
  .card .name{margin-top:8px;font-size:13px;color:var(--neon);font-weight:800;text-align:center;padding:0 6px}
  .center-marker{position:absolute;left:50%;transform:translateX(-50%);top:0;height:100%;width:6px;background:linear-gradient(180deg, rgba(200,150,255,0.14), rgba(200,150,255,0.22));box-shadow:0 0 30px rgba(168,85,247,0.12);pointer-events:none;border-radius:6px}

  /* controls & result */
  .controls{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:14px}
  #spin{padding:12px 22px;border-radius:999px;background:linear-gradient(90deg,var(--accent),#6d28d9);border:none;color:white;font-weight:800;cursor:pointer}
  #spin.disabled{opacity:.55;pointer-events:none}
  #remaining{font-weight:700;color:var(--muted)}
  #result{margin-top:12px;text-align:center;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;gap:12px;align-items:center;justify-content:center}
  .glow{padding:8px 12px;border-radius:8px;background:linear-gradient(90deg, rgba(168,85,247,0.12), rgba(168,85,247,0.06));box-shadow:0 12px 40px rgba(168,85,247,0.12);border:1px solid rgba(168,85,247,0.12)}
  .muted{color:var(--muted);font-size:13px}

  /* overlay preview */
  .overlay{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(3,2,6,0.7);z-index:9999;opacity:0;pointer-events:none;transition:opacity .22s}
  .overlay.show{opacity:1;pointer-events:auto}
  .preview-card{max-width:760px;padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(10,6,20,0.85), rgba(5,3,12,0.9));border:1px solid rgba(168,85,247,0.08);display:flex;flex-direction:column;align-items:center;gap:12px}
  .preview-card img{max-width:420px;max-height:420px}
  .close{padding:8px 12px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer;color:var(--muted)}

  /* responsive */
  @media(max-width:1100){ .gallery{grid-template-columns:repeat(5,1fr)} .card{width:130px;height:110px} }
  @media(max-width:720){ .gallery{grid-template-columns:repeat(2,1fr)} .card{width:120px;height:96px} .viewport{height:140px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div id="logo">LOGO</div>
      <div>
        <h1>Gacha Gallery</h1>
        <div class="sub">Tema: Ungu Neon — 10 mod • Klik banner untuk preview • Subscribe dapat 5x gacha</div>
      </div>
    </div>

    <div class="actions">
      <a id="subscribeBtn" class="btn" target="_blank">Subscribe</a>
      <div id="remaining" class="muted">Spins left: <span id="spinsCount">0</span></div>
      <button id="enterBtn" class="btn primary disabled" disabled>GACHA</button>
    </div>
  </header>

  <!-- Gallery banners (10 items) -->
  <div class="gallery" id="gallery"></div>

  <!-- Arena: track/slot machine -->
  <div class="arena">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="muted">Klik enter lalu SPIN untuk mula-ikan gacha. Musik & background diubah lewat repo.</div>
      <div class="muted">Logo & BG: edit di CONFIG pada script</div>
    </div>

    <div class="viewport" id="viewport">
      <div class="track" id="track"></div>
      <div class="center-marker"></div>
    </div>

    <div class="controls">
      <button id="spin" class="disabled">SPIN</button>
    </div>

    <div id="result" class="hidden"></div>
  </div>
</div>

<!-- overlay preview for PNG transparent character -->
<div id="overlay" class="overlay" role="dialog" aria-hidden="true">
  <div class="preview-card">
    <img id="previewImg" src="" alt="Preview">
    <div style="display:flex;gap:8px">
      <button id="downloadPreview" class="close">Download (from preview)</button>
      <button id="closePreview" class="close">Close</button>
    </div>
  </div>
</div>

<audio id="bgm" autoplay loop></audio>

<script>
/* ==========================
   CONFIG - edit in your repo
   ==========================
   - Change logoImage, backgroundImage, music URL
   - Change MODS array (image, preview png, file link, name)
*/
const CONFIG = {
  LOGO_TEXT: 'YOUR LOGO',
  LOGO_IMAGE: '', // if you want to use logo image, put URL here (leave empty to use text)
  BACKGROUND_IMAGE: '', // if you want a default background image (leave blank for solid bg)
  MUSIC_URL: 'https://music.youtube.com/watch?v=iisOyaFF58g&list=RDAMVMevTxdgbAF1Q', // replace with direct mp3 for reliable autoplay
  START_SPINS: 5, // spins given after clicking subscribe
  MODS: [
    // 10 mod entries (change image, preview PNG transparant, file link, name)
    {id:'m01', name:'Mod Alpha (SSR)', img:'https://via.placeholder.com/320x180?text=Alpha', preview:'https://via.placeholder.com/420x420.png?text=Alpha+PNG', file:'https://example.com/mod1.zip'},
    {id:'m02', name:'Mod Beta (SR)', img:'https://via.placeholder.com/320x180?text=Beta', preview:'https://via.placeholder.com/420x420.png?text=Beta+PNG', file:'https://example.com/mod2.zip'},
    {id:'m03', name:'Mod Gamma (R)', img:'https://via.placeholder.com/320x180?text=Gamma', preview:'https://via.placeholder.com/420x420.png?text=Gamma+PNG', file:'https://example.com/mod3.zip'},
    {id:'m04', name:'Mod Delta (R)', img:'https://via.placeholder.com/320x180?text=Delta', preview:'https://via.placeholder.com/420x420.png?text=Delta+PNG', file:'https://example.com/mod4.zip'},
    {id:'m05', name:'Mod Epsilon (SR)', img:'https://via.placeholder.com/320x180?text=Epsilon', preview:'https://via.placeholder.com/420x420.png?text=Epsilon+PNG', file:'https://example.com/mod5.zip'},
    {id:'m06', name:'Mod Zeta (SSR)', img:'https://via.placeholder.com/320x180?text=Zeta', preview:'https://via.placeholder.com/420x420.png?text=Zeta+PNG', file:'https://example.com/mod6.zip'},
    {id:'m07', name:'Mod Eta (R)', img:'https://via.placeholder.com/320x180?text=Eta', preview:'https://via.placeholder.com/420x420.png?text=Eta+PNG', file:'https://example.com/mod7.zip'},
    {id:'m08', name:'Mod Theta (SR)', img:'https://via.placeholder.com/320x180?text=Theta', preview:'https://via.placeholder.com/420x420.png?text=Theta+PNG', file:'https://example.com/mod8.zip'},
    {id:'m09', name:'Mod Iota (R)', img:'https://via.placeholder.com/320x180?text=Iota', preview:'https://via.placeholder.com/420x420.png?text=Iota+PNG', file:'https://example.com/mod9.zip'},
    {id:'m10', name:'Mod Kappa (SSR)', img:'https://via.placeholder.com/320x180?text=Kappa', preview:'https://via.placeholder.com/420x420.png?text=Kappa+PNG', file:'https://example.com/mod10.zip'}
  ]
};

/* ==========================
   End CONFIG
   ==========================*/

const galleryEl = document.getElementById('gallery');
const track = document.getElementById('track');
const viewport = document.getElementById('viewport');
const subscribeBtn = document.getElementById('subscribeBtn');
const enterBtn = document.getElementById('enterBtn');
const spinBtn = document.getElementById('spin');
const result = document.getElementById('result');
const spinsCountEl = document.getElementById('spinsCount');
const overlay = document.getElementById('overlay');
const previewImg = document.getElementById('previewImg');
const downloadPreview = document.getElementById('downloadPreview');
const closePreview = document.getElementById('closePreview');
const bgm = document.getElementById('bgm');
const logoEl = document.getElementById('logo');

let spinsLeft = 0;
const STORAGE_KEY = 'gacha_spins_v1';
const SUB_CLICK_KEY = 'gacha_sub_clicked_v1';

// init UI from CONFIG
function initUI(){
  // set logo
  if(CONFIG.LOGO_IMAGE){
    logoEl.style.backgroundImage = `url(${CONFIG.LOGO_IMAGE})`;
    logoEl.textContent = '';
    logoEl.style.backgroundSize = 'cover';
    logoEl.style.backgroundPosition = 'center';
  } else {
    logoEl.textContent = CONFIG.LOGO_TEXT || 'LOGO';
  }
  // background
  if(CONFIG.BACKGROUND_IMAGE){
    document.body.style.backgroundImage = `url(${CONFIG.BACKGROUND_IMAGE})`;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center';
  }

  // music
  if(CONFIG.MUSIC_URL){
    bgm.src = CONFIG.MUSIC_URL; // NOTE: direct MP3 preferred
    bgm.volume = 0.7;
    bgm.play().catch(()=>{ /* autoplay may be blocked until user interaction */ });
  }

  // build gallery banners
  galleryEl.innerHTML = '';
  CONFIG.MODS.forEach((m, idx)=>{
    const d = document.createElement('div');
    d.className = 'banner';
    d.dataset.idx = idx;
    d.innerHTML = `<img src="${m.img}" alt="${m.name}"><div class="bname">${m.name}</div>`;
    d.addEventListener('click', ()=>{ openPreview(idx); });
    galleryEl.appendChild(d);
  });

  // build track (duplicate array for smooth looping)
  buildTrack();
  // load spins left from storage
  const s = parseInt(localStorage.getItem(STORAGE_KEY) || '0', 10);
  spinsLeft = isNaN(s) ? 0 : s;
  updateSpinsUI();
  if(localStorage.getItem(SUB_CLICK_KEY)) enableEnter();
}
initUI();

/* Build duplicated track with two copies (so left-right movement can loop visually) */
function buildTrack(){
  track.innerHTML = '';
  const arr = CONFIG.MODS.concat(CONFIG.MODS); // duplicate once
  arr.forEach(m=>{
    const c = document.createElement('div');
    c.className = 'card';
    c.dataset.id = m.id;
    c.dataset.file = m.file;
    c.innerHTML = `<img src="${m.img}" alt="${m.name}"><div class="name">${m.name}</div>`;
    track.appendChild(c);
  });
}

/* Preview overlay when banner clicked */
function openPreview(idx){
  const mod = CONFIG.MODS[idx];
  if(!mod) return;
  previewImg.src = mod.preview || mod.img || '';
  previewImg.alt = mod.name;
  // show overlay
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden', 'false');
  // set download preview click
  downloadPreview.onclick = ()=>{ window.open(mod.file, '_blank'); };
}
closePreview.onclick = ()=>{ overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); };
overlay.addEventListener('click', e=>{ if(e.target === overlay) { overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); } });

/* Subscribe click: set spins to START_SPINS and enable gacha */
subscribeBtn.addEventListener('click', ()=>{
  localStorage.setItem(SUB_CLICK_KEY, Date.now());
  spinsLeft = CONFIG.START_SPINS;
  localStorage.setItem(STORAGE_KEY, spinsLeft);
  updateSpinsUI();
  enableEnter();
  // open channel in separate tab (subscribe link)
  // NOTE: user should replace subscribe URL in anchor if desired
  setTimeout(()=>{ try{ window.open(subscribeBtn.href || '#', '_blank'); }catch(e){} }, 50);
});

function enableEnter(){
  enterBtn.disabled = false;
  enterBtn.classList.remove('disabled');
  spinBtn.disabled = false;
  spinBtn.classList.remove('disabled');
}
enterBtn.addEventListener('click', ()=>{ viewport.scrollIntoView({behavior:'smooth', block:'center'}); bgm.play().catch(()=>{}); });

/* SPIN: left-right slot movement, slows and stops on chosen index */
let isSpinning = false;
spinBtn.addEventListener('click', ()=>{ if(isSpinning) return; if(spinsLeft <= 0){ alert('Tidak ada spin tersisa. Klik Subscribe untuk mendapatkan 5 spin.'); return; } startSpin(); });

function updateSpinsUI(){
  spinsCountEl.textContent = spinsLeft;
}

/* Spin mechanics */
function startSpin(){
  isSpinning = true;
  result.classList.add('hidden');

  // choose final index among first 10 mods
  const finalIdx = Math.floor(Math.random() * CONFIG.MODS.length);
  const chosenMod = CONFIG.MODS[finalIdx];

  // find the DOM card corresponding to the first copy (index = finalIdx)
  const cards = Array.from(track.children);
  const chosenCard = cards[finalIdx]; // since first copy is 0..9
  // calculate measurements
  const viewportRect = viewport.getBoundingClientRect();
  const cardRect = chosenCard.getBoundingClientRect();
  const cardWidthWithGap = cardRect.width + 14; // approximate gap
  // target translate so chosenCard centers under center-marker
  const chosenOffset = chosenCard.offsetLeft;
  const viewportCenter = viewport.clientWidth / 2;
  const targetTranslate = -(chosenOffset - (viewportCenter - (cardRect.width/2)));

  // animate movement: start fast to left (negative), then slow down and ease to target
  let currentX = 0;
  let velocity = 260 + Math.random()*120; // pixel/sec approx
  const frictionBase = 0.993; // per frame multiplier approximation
  let friction = frictionBase - Math.random()*0.003;
  let rafId;

  function frame(){
    // update position (normalize to 60fps)
    currentX -= velocity * (1/60);
    // loop-around visual: keep currentX bounded to avoid huge numbers
    // apply transform
    track.style.transform = `translateX(${currentX}px)`;
    // slow velocity
    velocity *= friction;

    // when slow enough begin precise easing to target
    if(velocity < 30){
      // ease to targetTranslate
      const dx = targetTranslate - currentX;
      currentX += dx * 0.12;
      track.style.transform = `translateX(${currentX}px)`;
      if(Math.abs(dx) < 1){
        cancelAnimationFrame(rafId);
        finishSpin(chosenMod);
        return;
      }
    } else {
      rafId = requestAnimationFrame(frame);
    }
  }
  rafId = requestAnimationFrame(frame);
}

/* After spin finishes */
function finishSpin(mod){
  isSpinning = false;
  // decrement spins and store
  spinsLeft = Math.max(0, spinsLeft - 1);
  localStorage.setItem(STORAGE_KEY, spinsLeft);
  updateSpinsUI();

  // show result + download button
  result.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;gap:10px">
      <div class="glow">Selamat — Anda mendapatkan <strong>${mod.name}</strong></div>
      <div><a id="dlBtn" class="btn" href="${mod.file}" target="_blank">Download Mod</a></div>
      <div class="muted">Spins tersisa: ${spinsLeft}</div>
    </div>`;
  result.classList.remove('hidden');

  // optional: show the preview overlay automatically for flair
  previewImg.src = mod.preview || mod.img || '';
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden','false');
}

/* allow pressing center of viewport to quick spin on mobile */
viewport.addEventListener('click', ()=>{ if(!isSpinning && spinsLeft > 0) startSpin(); });

/* initial subscribe link href (change in repo if needed) */
subscribeBtn.href = 'https://www.youtube.com/'; // change to your channel in repo

/* keyboard support: space to spin if enabled */
window.addEventListener('keydown', (e)=>{ if(e.code === 'Space'){ e.preventDefault(); if(!isSpinning && spinsLeft>0) startSpin(); } });

/* Prevent overlay image dragging */
previewImg.ondragstart = ()=>false;

</script>
</body>
</html>
