<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>High-Tier Gacha Showcase • Shining Aura</title>
  <meta name="description" content="High-end cinematic gacha showcase with shining effects and character auras — dual mode: Showcase & Gacha."/>
  <style>
    /* ---------- THEME COLORS ---------- */
    :root{
      --bg-1:#041022; --bg-2:#07142a;
      --panel:#081829; --glass:rgba(255,255,255,0.03);
      --accent-a:#39d2ff; --accent-b:#9b7bff;
      --muted:#94a6bf; --gold:#f3d48f;
      --mythic-glow:#ffd700; --legend-glow:#9b7bff;
      --elite-glow:#39d2ff; --common-glow:#94a6bf;
    }

    /* ---------- RESET & BASE ---------- */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#e6f3ff;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased;overflow:hidden}
    a{color:inherit}
    button{font-family:inherit}

    /* ---------- LAYOUT ---------- */
    .app{display:flex;flex-direction:column;height:100vh;width:100vw}
    
    /* Header dengan efek shine */
    header.top{height:72px;display:flex;align-items:center;justify-content:space-between;padding:0 28px;background:linear-gradient(180deg, rgba(255,255,255,0.05), transparent);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.02);position:relative;overflow:hidden}
    .shine-effect{position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);animation:shine 8s infinite}
    
    @keyframes shine{
      0%{left:-100%}
      20%{left:100%}
      100%{left:100%}
    }

    .brand{display:flex;gap:14px;align-items:center;position:relative;z-index:2}
    .logo{width:50px;height:50px;border-radius:12px;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));display:flex;align-items:center;justify-content:center;color:#021226;font-weight:800;box-shadow:0 10px 40px rgba(57,210,255,0.15);animation:pulse 4s ease-in-out infinite}
    .title{font-weight:800;letter-spacing:0.6px;background:linear-gradient(45deg, var(--accent-a), var(--accent-b));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .subtitle{font-size:12px;color:var(--muted);margin-top:2px}

    @keyframes pulse{
      0%, 100%{transform:scale(1);box-shadow:0 10px 40px rgba(57,210,255,0.15)}
      50%{transform:scale(1.05);box-shadow:0 15px 50px rgba(57,210,255,0.25)}
    }

    nav.controls{display:flex;gap:10px;align-items:center;position:relative;z-index:2}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;cursor:pointer;font-weight:700;transition:all 0.3s ease;position:relative;overflow:hidden}
    .btn.ghost{background:transparent}
    .btn.primary{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#021226;border:none;box-shadow:0 8px 30px rgba(57,210,255,0.15)}
    .btn.small{padding:8px 10px;font-size:13px}
    .btn:disabled{opacity:0.6;cursor:not-allowed}
    .btn:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 12px 40px rgba(57,210,255,0.2)}

    main.main{flex:1;display:flex;gap:28px;padding:26px 36px;position:relative;overflow:hidden}

    /* left column */
    aside.left{width:260px;display:flex;flex-direction:column;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 16px 60px rgba(2,6,20,0.55);position:relative;overflow:hidden}
    .card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.03), transparent);animation:cardShine 6s infinite}
    .card h4{color:var(--accent-a);margin-bottom:10px;position:relative;z-index:1}
    .muted{color:var(--muted);font-size:13px;position:relative;z-index:1}

    @keyframes cardShine{
      0%{left:-100%}
      20%{left:100%}
      100%{left:100%}
    }

    /* center area */
    .center{flex:1;position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden}

    /* background slideshow container */
    .bg-container{position:absolute;inset:0;z-index:0;overflow:hidden}
    .bg-slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transform:scale(1.03);transition:opacity 1200ms ease, transform 1000ms ease}
    .bg-slide.active{opacity:1;transform:scale(1)}
    .bg-overlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(2,6,20,0.25), rgba(2,6,30,0.6));z-index:1}

    /* showcase carousel container */
    .showcase-wrap{position:relative;z-index:2;width:100%;max-width:1400px;padding:48px 32px;display:flex;flex-direction:column;gap:18px;align-items:center;justify-content:center}
    .showcase-title{display:flex;align-items:center;gap:12px}
    .showcase-title h2{font-size:20px;letter-spacing:1px;background:linear-gradient(45deg, var(--accent-a), var(--accent-b));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .showcase-view{width:100%;overflow:hidden;padding:20px 0 28px 0;position:relative}
    
    /* slider navigation */
    .slider-nav{display:flex;gap:10px;align-items:center}
    .nav-btn{width:40px;height:40px;border-radius:50%;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:var(--accent-a);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:all 0.3s ease;position:relative;overflow:hidden}
    .nav-btn:hover{background:rgba(255,255,255,0.1);transform:scale(1.1);box-shadow:0 0 20px rgba(57,210,255,0.3)}
    .nav-btn:disabled{opacity:0.4;cursor:not-allowed}

    .carousel{display:flex;gap:28px;align-items:center;will-change:transform;transition:transform 500ms cubic-bezier(.2,.9,.2,1)}
    
    /* panel - medium size dengan aura */
    .panel{width:280px;height:620px;border-radius:14px;overflow:visible;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.08));backdrop-filter:blur(6px);position:relative;box-shadow:0 40px 120px rgba(2,8,20,0.6);transform:skewX(-8deg);transition:transform 350ms, box-shadow 350ms, filter 300ms}
    .panel-inner{transform:skewX(8deg);width:100%;height:100%;position:relative;display:flex;flex-direction:column;align-items:center;border-radius:14px;overflow:hidden}
    
    /* Aura effect container */
    .aura-container{position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px;border-radius:20px;z-index:0;opacity:0;transition:opacity 0.5s ease;pointer-events:none}
    .panel.active .aura-container{opacity:1}
    .aura{position:absolute;top:0;left:0;right:0;bottom:0;border-radius:20px;background:conic-gradient(from 0deg, transparent, var(--aura-color), transparent);animation:rotateAura 3s linear infinite;filter:blur(20px)}
    .aura-2{animation-delay:-1.5s;filter:blur(15px)}
    
    @keyframes rotateAura{
      0%{transform:rotate(0deg)}
      100%{transform:rotate(360deg)}
    }

    .panel img{width:100%;height:82%;object-fit:cover;display:block;border-bottom:1px solid rgba(255,255,255,0.03);position:relative;z-index:1;transition:all 0.3s ease}
    .panel.active img{filter:brightness(1.1) contrast(1.1)}
    
    .panel .meta{padding:16px;width:100%;display:flex;align-items:center;justify-content:space-between;position:relative;z-index:1;background:linear-gradient(180deg, transparent, rgba(8,24,41,0.9))}
    .pname{font-weight:800;color:var(--accent-a);font-size:18px;text-shadow:0 2px 10px rgba(0,0,0,0.5)}
    .prarity{font-weight:700;font-size:12px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);color:var(--muted)}

    /* hover focus dengan efek glow */
    .panel:hover{transform:translateY(-18px) skewX(-8deg) scale(1.06);box-shadow:0 60px 140px rgba(3,12,30,0.75);filter:brightness(1.04)}
    .panel:hover .aura-container{opacity:0.7}
    .panel.active{transform:translateY(-12px) skewX(-8deg) scale(1.03);box-shadow:0 50px 130px var(--aura-glow)}

    /* hero spotlight */
    .hero-spot{position:absolute;right:4%;bottom:6%;z-index:3;width:420px;height:640px;border-radius:16px;padding:22px;display:flex;align-items:flex-end;justify-content:center;box-shadow:0 60px 160px rgba(3,10,20,0.6);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15));border:1px solid rgba(255,255,255,0.03);position:relative;overflow:hidden}
    .hero-spot::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);animation:cardShine 8s infinite}
    .hero-spot h3{font-size:28px;color:var(--accent-b);margin-bottom:6px;position:relative;z-index:1}
    .hero-spot p{color:var(--muted);font-size:14px;position:relative;z-index:1}

    /* gacha board dengan efek shine */
    .gacha-board{position:absolute;left:50%;transform:translateX(-50%);bottom:28px;z-index:4;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px 18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:18px;align-items:center;backdrop-filter:blur(8px);position:relative;overflow:hidden}
    .gacha-board::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(57,210,255,0.1), transparent);animation:cardShine 10s infinite}
    
    .gtiles{display:flex;gap:12px}
    .gtile{width:88px;height:116px;border-radius:10px;overflow:hidden;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.03);transition:transform 300ms, box-shadow 300ms;position:relative}
    .gtile::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;border-radius:10px;background:linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);opacity:0;transition:opacity 0.3s ease}
    .gtile:hover::before{opacity:1}
    .gtile.sel{box-shadow:0 20px 60px rgba(57,210,255,0.3);transform:translateY(-10px);border-color:var(--accent-a)}
    
    .spin-btn{padding:12px 28px;border-radius:12px;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));border:none;font-weight:900;cursor:pointer;box-shadow:0 18px 60px rgba(57,210,255,0.15);transition:all 0.3s ease;position:relative;overflow:hidden}
    .spin-btn:disabled{opacity:0.6;cursor:not-allowed}
    .spin-btn:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 25px 80px rgba(57,210,255,0.25)}
    .spin-btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);transition:left 0.5s ease}
    .spin-btn:hover::before{left:100%}

    /* result popup dengan efek glow */
    .result-overlay{position:fixed;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;background:rgba(0,6,12,0.8);pointer-events:none;opacity:0;transition:opacity 260ms;backdrop-filter:blur(5px)}
    .result-overlay.open{pointer-events:auto;opacity:1}
    .result-card{width:520px;background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));padding:26px;border-radius:14px;border:1px solid rgba(255,255,255,0.05);text-align:center;box-shadow:0 40px 140px rgba(2,6,20,0.8);position:relative;overflow:hidden;transform:scale(0.9);transition:transform 0.3s ease}
    .result-overlay.open .result-card{transform:scale(1)}
    .result-card::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:conic-gradient(from 0deg, transparent, var(--result-glow, rgba(57,210,255,0.1)), transparent);border-radius:14px;animation:rotateAura 4s linear infinite;filter:blur(30px)}
    .result-card h2{color:var(--gold);margin-bottom:8px;position:relative;z-index:1;font-size:24px}
    .result-card p{color:var(--muted);position:relative;z-index:1}
    .result-actions{display:flex;gap:12px;justify-content:center;margin-top:16px;position:relative;z-index:1}

    /* loading spinner */
    .spinner{width:20px;height:20px;border:2px solid transparent;border-top:2px solid currentColor;border-radius:50%;animation:spin 1s linear infinite;display:inline-block}

    @keyframes spin{
      0%{transform:rotate(0deg)}
      100%{transform:rotate(360deg)}
    }

    /* small screens */
    @media (max-width:1100px){
      .hero-spot{display:none}
      .panel{width:240px;height:520px}
    }
    @media (max-width:720px){
      aside.left{display:none}
      .panel{width:200px;height:420px}
      .showcase-wrap{padding:20px}
      .gacha-board{left:8%;transform:none;bottom:18px;flex-direction:column;width:95%}
      .main{padding:10px}
      .shine-effect{animation:shine 12s infinite}
    }

    /* utility */
    .hide{display:none}
    .flex{display:flex}
    .center{align-items:center;justify-content:center}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  </style>
</head>
<body>
  <div class="app">
    <header class="top" role="banner" aria-label="Header utama">
      <div class="shine-effect"></div>
      <div class="brand">
        <div class="logo" aria-label="Logo Gacha">G</div>
        <div>
          <div class="title">Gacha • Event Showcase</div>
          <div class="subtitle">Limited Summon • Cinematic Visual</div>
        </div>
      </div>

      <nav class="controls" aria-label="Navigasi kontrol">
        <button id="modeBtn" class="btn ghost small">Mode: Showcase</button>
        <button id="openChannel" class="btn small">Open Channel</button>
        <button id="enableBtn" class="btn primary" disabled>Enable Gacha</button>
      </nav>
    </header>

    <main class="main" role="main" aria-label="Konten utama">
      <!-- LEFT: info -->
      <aside class="left" aria-label="Informasi panel">
        <div class="card">
          <h4>How it works</h4>
          <p class="muted">Open your channel, enable gacha, then switch to <strong>Gacha Mode</strong>. This template is client-side demo; edit assets & rarity in JS.</p>
        </div>

        <div class="card">
          <h4>Rarity Rates</h4>
          <p class="muted" id="ratesSummary">Edit rates in script</p>
        </div>

        <div class="card">
          <h4>Customization</h4>
          <p class="muted">Replace images in <code>/assets/</code>. Fill background slides in the script (SLIDES array). Music file: <code>/music.mp3</code>.</p>
        </div>
      </aside>

      <!-- CENTER: showcase & gacha -->
      <section class="center" aria-label="Area showcase dan gacha">
        <div class="bg-container" id="bgContainer"><!-- slides added by JS --></div>
        <div class="bg-overlay"></div>

        <div class="showcase-wrap" id="showcaseWrap">
          <div class="showcase-title" style="width:100%;justify-content:space-between">
            <div>
              <h2>Character Showcase</h2>
              <div class="muted">Manual slider • 6 characters • Click to preview</div>
            </div>
            <div class="slider-nav">
              <button id="prevBtn" class="nav-btn" aria-label="Previous character">←</button>
              <span class="muted" id="slideCounter">1/6</span>
              <button id="nextBtn" class="nav-btn" aria-label="Next character">→</button>
            </div>
          </div>

          <div class="showcase-view" id="showcaseView">
            <div id="carousel" class="carousel">
              <!-- 6 panels dengan ukuran medium dan aura -->
              <div class="panel" data-name="Aurelia" data-rarity="Mythic" data-file="mods/aurelia.zip" data-description="Abyss Walker" data-aura-color="#ffd700">
                <div class="aura-container">
                  <div class="aura" style="--aura-color: #ffd700"></div>
                  <div class="aura aura-2" style="--aura-color: #ffd700"></div>
                </div>
                <div class="panel-inner">
                  <img src="assets/panels/panel1.jpg" alt="Karakter Aurelia - Mythic rarity" onerror="handleImageError(this)">
                  <div class="meta">
                    <div class="pname">Aurelia</div>
                    <div class="prarity">Mythic</div>
                  </div>
                </div>
              </div>

              <div class="panel" data-name="Korven" data-rarity="Legendary" data-file="mods/korven.zip" data-description="Dragon Knight" data-aura-color="#9b7bff">
                <div class="aura-container">
                  <div class="aura" style="--aura-color: #9b7bff"></div>
                  <div class="aura aura-2" style="--aura-color: #9b7bff"></div>
                </div>
                <div class="panel-inner">
                  <img src="assets/panels/panel2.jpg" alt="Karakter Korven - Legendary rarity" onerror="handleImageError(this)">
                  <div class="meta">
                    <div class="pname">Korven</div>
                    <div class="prarity">Legend</div>
                  </div>
                </div>
              </div>

              <div class="panel" data-name="Sibyl" data-rarity="Elite" data-file="mods/sibyl.zip" data-description="Oracle Seer" data-aura-color="#39d2ff">
                <div class="aura-container">
                  <div class="aura" style="--aura-color: #39d2ff"></div>
                  <div class="aura aura-2" style="--aura-color: #39d2ff"></div>
                </div>
                <div class="panel-inner">
                  <img src="assets/panels/panel3.jpg" alt="Karakter Sibyl - Elite rarity" onerror="handleImageError(this)">
                  <div class="meta">
                    <div class="pname">Sibyl</div>
                    <div class="prarity">Elite</div>
                  </div>
                </div>
              </div>

              <div class="panel" data-name="Truffle" data-rarity="Common" data-file="mods/truffle.zip" data-description="Forest Guardian" data-aura-color="#94a6bf">
                <div class="aura-container">
                  <div class="aura" style="--aura-color: #94a6bf"></div>
                  <div class="aura aura-2" style="--aura-color: #94a6bf"></div>
                </div>
                <div class="panel-inner">
                  <img src="assets/panels/panel4.jpg" alt="Karakter Truffle - Common rarity" onerror="handleImageError(this)">
                  <div class="meta">
                    <div class="pname">Truffle</div>
                    <div class="prarity">Common</div>
                  </div>
                </div>
              </div>

              <div class="panel" data-name="Rebecca" data-rarity="Elite" data-file="mods/rebecca.zip" data-description="Cyber Ninja" data-aura-color="#39d2ff">
                <div class="aura-container">
                  <div class="aura" style="--aura-color: #39d2ff"></div>
                  <div class="aura aura-2" style="--aura-color: #39d2ff"></div>
                </div>
                <div class="panel-inner">
                  <img src="assets/panels/panel5.jpg" alt="Karakter Rebecca - Elite rarity" onerror="handleImageError(this)">
                  <div class="meta">
                    <div class="pname">Rebecca</div>
                    <div class="prarity">Elite</div>
                  </div>
                </div>
              </div>

              <div class="panel" data-name="Fen" data-rarity="Legendary" data-file="mods/fen.zip" data-description="Phoenix Mage" data-aura-color="#9b7bff">
                <div class="aura-container">
                  <div class="aura" style="--aura-color: #9b7bff"></div>
                  <div class="aura aura-2" style="--aura-color: #9b7bff"></div>
                </div>
                <div class="panel-inner">
                  <img src="assets/panels/panel6.jpg" alt="Karakter Fen - Legendary rarity" onerror="handleImageError(this)">
                  <div class="meta">
                    <div class="pname">Fen</div>
                    <div class="prarity">Legend</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- hero spotlight -->
        <div class="hero-spot" id="heroSpot">
          <div>
            <h3 id="heroName">Aurelia</h3>
            <p id="heroDesc" class="muted">Mythic • Abyss Walker</p>
          </div>
        </div>

        <!-- gacha board (hidden initially) -->
        <div class="gacha-board hide" id="gachaBoard" aria-label="Portal summon gacha">
          <div style="display:flex;flex-direction:column;gap:8px;min-width:220px;position:relative;z-index:1">
            <div style="font-weight:800">Summon Portal</div>
            <div class="muted" style="font-size:13px">Click SUMMON to perform a visual summon (client-side demo)</div>
          </div>

          <div class="gtiles" id="gtiles" style="position:relative;z-index:1">
            <!-- 6 box seperti yang diminta -->
            <div class="gtile"><img src="assets/thumbnails/thumb1.jpg" style="width:100%;height:100%;object-fit:cover" alt="Thumbnail karakter 1" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb2.jpg" style="width:100%;height:100%;object-fit:cover" alt="Thumbnail karakter 2" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb3.jpg" style="width:100%;height:100%;object-fit:cover" alt="Thumbnail karakter 3" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb4.jpg" style="width:100%;height:100%;object-fit:cover" alt="Thumbnail karakter 4" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb5.jpg" style="width:100%;height:100%;object-fit:cover" alt="Thumbnail karakter 5" onerror="handleImageError(this)"></div>
            <div class="gtile"><img src="assets/thumbnails/thumb6.jpg" style="width:100%;height:100%;object-fit:cover" alt="Thumbnail karakter 6" onerror="handleImageError(this)"></div>
          </div>

          <div style="display:flex;flex-direction:column;gap:10px;align-items:center;position:relative;z-index:1">
            <button id="summonBtn" class="spin-btn" disabled>SUMMON</button>
            <button id="singleSummon" class="btn small" disabled>Single</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- result overlay -->
  <div class="result-overlay" id="resultOverlay" aria-hidden="true">
    <div class="result-card">
      <h2 id="resultTitle">Mythic • You Obtained Aurelia</h2>
      <p id="resultText">Beautiful reveal animation — replace file logic later.</p>
      <div class="result-actions">
        <button id="claimBtn" class="btn primary">Claim (open file)</button>
        <button id="closeResult" class="btn">Close</button>
      </div>
    </div>
  </div>

  <!-- background music (put music.mp3 in repo) -->
  <audio id="bgMusic" src="music.mp3" loop></audio>

  <script>
    /************************************************************************
     * ENHANCED TEMPLATE SCRIPT WITH SHINE EFFECTS & AURAS
     * - Manual slider system (no auto-loop)
     * - Medium sized panels with character auras
     * - Shining effects on headers and buttons
     * - 6 boxes in summon portal
     * - Better accessibility and error handling
     ************************************************************************/

    /* ---------------------- CONFIG (edit these) ---------------------- */
    const SLIDES = [
      'assets/backgrounds/bg1.jpg',
      'assets/backgrounds/bg2.jpg',
      'assets/backgrounds/bg3.jpg',
      'assets/backgrounds/bg4.jpg'
    ];

    const rarityRates = {
      Mythic: 0.02,
      Legendary: 0.08,
      Elite: 0.2,
      Common: 0.7
    };

    const rarityColors = {
      Mythic: '#f3d48f',
      Legendary: '#9b7bff',
      Elite: '#39d2ff',
      Common: '#94a6bf'
    };

    const rarityGlow = {
      Mythic: 'rgba(243, 212, 143, 0.3)',
      Legendary: 'rgba(155, 123, 255, 0.3)',
      Elite: 'rgba(57, 210, 255, 0.3)',
      Common: 'rgba(148, 166, 191, 0.3)'
    };

    const YT_CHANNEL = 'https://youtube.com/';

    /* ---------------------- UTILITY FUNCTIONS ---------------------- */
    function clamp(v, a=0, b=1){ return Math.max(a, Math.min(b, v)); }
    function rand(){ return Math.random(); }
    function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

    // Error handling for images
    function handleImageError(img) {
      img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDgxODI5Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjMzlkMmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgTm90IEZvdW5kPC90ZXh0Pjwvc3ZnPg==';
      img.alt = 'Gambar tidak tersedia';
    }

    // Preload critical images
    function preloadImages() {
      const criticalImages = [
        'assets/panels/panel1.jpg', 'assets/panels/panel2.jpg', 'assets/panels/panel3.jpg',
        'assets/panels/panel4.jpg', 'assets/panels/panel5.jpg', 'assets/panels/panel6.jpg',
        'assets/thumbnails/thumb1.jpg', 'assets/thumbnails/thumb2.jpg', 'assets/thumbnails/thumb3.jpg',
        'assets/thumbnails/thumb4.jpg', 'assets/thumbnails/thumb5.jpg', 'assets/thumbnails/thumb6.jpg',
        'assets/backgrounds/bg1.jpg', 'assets/backgrounds/bg2.jpg', 'assets/backgrounds/bg3.jpg', 'assets/backgrounds/bg4.jpg'
      ];
      
      criticalImages.forEach(src => {
        const img = new Image();
        img.src = src;
        img.onerror = () => console.warn('Failed to load:', src);
      });
    }

    /* ---------------------- INITIALIZATION ---------------------- */
    // Validate and build rarity CDF
    const rarityKeys = Object.keys(rarityRates);
    const rates = rarityKeys.map(k => rarityRates[k]);
    const totalRate = rates.reduce((s,x)=>s+x,0);
    if(Math.abs(totalRate - 1) > 1e-6){
      for(const k of rarityKeys) rarityRates[k] = rarityRates[k] / totalRate;
    }

    let cdf = [];
    (function buildCDF(){
      let sum = 0;
      for(const k of rarityKeys){ sum += rarityRates[k]; cdf.push({key:k, at:sum}); }
    })();

    // DOM references
    const modeBtn = document.getElementById('modeBtn');
    const openChannelBtn = document.getElementById('openChannel');
    const enableBtn = document.getElementById('enableBtn');
    const carousel = document.getElementById('carousel');
    const showcaseView = document.getElementById('showcaseView');
    const heroName = document.getElementById('heroName');
    const heroDesc = document.getElementById('heroDesc');
    const heroSpot = document.getElementById('heroSpot');
    const gachaBoard = document.getElementById('gachaBoard');
    const summonBtn = document.getElementById('summonBtn');
    const singleSummon = document.getElementById('singleSummon');
    const resultOverlay = document.getElementById('resultOverlay');
    const resultTitle = document.getElementById('resultTitle');
    const resultText = document.getElementById('resultText');
    const claimBtn = document.getElementById('claimBtn');
    const closeResult = document.getElementById('closeResult');
    const bgContainer = document.getElementById('bgContainer');
    const ratesSummary = document.getElementById('ratesSummary');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const slideCounter = document.getElementById('slideCounter');

    let panels = Array.from(document.querySelectorAll('.panel'));
    let currentSlide = 0;
    const totalSlides = panels.length;

    /* ---------------------- IMPROVED FUNCTIONS ---------------------- */
    function updateRatesSummary(){
      ratesSummary.textContent = rarityKeys.map(k => `${k}: ${(rarityRates[k]*100).toFixed(2)}%`).join(' • ');
    }
    updateRatesSummary();

    // Manual slider system (no auto-loop)
    function updateSlider() {
      const offset = -currentSlide * (280 + 28); // panel width + gap
      carousel.style.transform = `translate3d(${offset}px, 0, 0)`;
      slideCounter.textContent = `${currentSlide + 1}/${totalSlides}`;
      
      // Update navigation buttons
      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide === totalSlides - 1;
      
      // Update active panel and hero spotlight
      updateActivePanel();
    }

    function updateActivePanel() {
      panels.forEach((panel, index) => {
        if (index === currentSlide) {
          panel.classList.add('active');
          const name = panel.dataset.name || 'Unknown';
          const rarity = panel.dataset.rarity || '';
          const description = panel.dataset.description || '';
          const auraColor = panel.dataset.auraColor || '#39d2ff';
          
          heroName.textContent = name;
          heroDesc.textContent = `${rarity} • ${description}`;
          
          // Set CSS variable for glow effects
          panel.style.setProperty('--aura-glow', rarityGlow[rarity] || 'rgba(57,210,255,0.3)');
        } else {
          panel.classList.remove('active');
        }
      });
    }

    function goToSlide(index) {
      currentSlide = clamp(index, 0, totalSlides - 1);
      updateSlider();
    }

    function nextSlide() {
      if (currentSlide < totalSlides - 1) {
        currentSlide++;
        updateSlider();
      }
    }

    function prevSlide() {
      if (currentSlide > 0) {
        currentSlide--;
        updateSlider();
      }
    }

    // Background slideshow
    (function setupBackgroundSlides(){
      if(SLIDES.length === 0) return;
      SLIDES.forEach((src,i)=>{
        const s = document.createElement('div');
        s.className = 'bg-slide';
        s.style.backgroundImage = `url(${src})`;
        if(i===0) s.classList.add('active');
        bgContainer.appendChild(s);
      });
      let idx = 0;
      setInterval(()=>{
        const slides = bgContainer.querySelectorAll('.bg-slide');
        if(!slides || slides.length===0) return;
        slides[idx].classList.remove('active');
        idx = (idx+1)%slides.length;
        slides[idx].classList.add('active');
      }, 6000);
    })();

    /* ---------------------- EVENT LISTENERS ---------------------- */
    // Slider navigation
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prevSlide();
      if (e.key === 'ArrowRight') nextSlide();
      if (e.key === 'Escape' && resultOverlay.classList.contains('open')) {
        resultOverlay.classList.remove('open');
        resultOverlay.setAttribute('aria-hidden', 'true');
      }
    });

    // Panel interactions
    panels.forEach((panel, index) => {
      panel.addEventListener('click', () => {
        goToSlide(index);
      });
    });

    // Mode switching
    let currentMode = 'showcase';
    function setMode(mode){
      currentMode = mode;
      modeBtn.textContent = `Mode: ${mode.charAt(0).toUpperCase()+mode.slice(1)}`;
      if(mode === 'showcase'){
        document.getElementById('showcaseWrap').style.opacity = 1;
        gachaBoard.classList.add('hide');
      } else {
        document.getElementById('showcaseWrap').style.opacity = 0.14;
        gachaBoard.classList.remove('hide');
      }
    }
    modeBtn.addEventListener('click', ()=>{ 
      setMode(currentMode==='showcase' ? 'gacha' : 'showcase'); 
    });

    // Channel subscription
    openChannelBtn.addEventListener('click', ()=>{
      window.open(YT_CHANNEL, '_blank');
      localStorage.setItem('subClicked', Date.now());
      enableBtn.disabled = false;
      enableBtn.classList.add('primary');
    });

    enableBtn.addEventListener('click', ()=>{
      setMode('gacha');
      summonBtn.disabled = false;
      singleSummon.disabled = false;
    });

    if(localStorage.getItem('subClicked')){ 
      enableBtn.disabled = false;
      enableBtn.classList.add('primary');
    }

    /* ---------------------- ENHANCED GACHA SYSTEM ---------------------- */
    function chooseRarity(){
      const r = Math.random();
      for(const node of cdf){ if(r <= node.at) return node.key; }
      return cdf[cdf.length-1].key;
    }

    function pickPanelByRarity(rarity){
      const matches = panels.filter(p => (p.dataset.rarity || '').toLowerCase() === rarity.toLowerCase());
      if(matches.length > 0) return matches[Math.floor(Math.random()*matches.length)];
      return panels[Math.floor(Math.random()*panels.length)];
    }

    function hexToRgba(hex, a=1){
      try{
        const h = hex.replace('#','');
        const bigint = parseInt(h,16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return `rgba(${r},${g},${b},${a})`;
      }catch(e){ return `rgba(57,210,255,${a})`; }
    }

    async function revealPanel(panel){
      panels.forEach(x=>x.classList.remove('sel')); 
      panel.classList.add('sel');
      
      const name = panel.dataset.name || 'Unknown';
      const rarity = panel.dataset.rarity || 'Unknown';
      const description = panel.dataset.description || '';
      const auraColor = panel.dataset.auraColor || '#39d2ff';
      
      resultTitle.textContent = `${rarity} • You Obtained ${name}`;
      resultText.textContent = `${description} - Shining reveal!`;
      claimBtn.dataset.file = panel.dataset.file || '';
      
      // Set result card glow based on rarity
      const resultCard = document.querySelector('.result-card');
      resultCard.style.setProperty('--result-glow', rarityGlow[rarity] || 'rgba(57,210,255,0.2)');
      
      resultOverlay.classList.add('open');
      resultOverlay.setAttribute('aria-hidden', 'false');
    }

    async function performSummon(full=true){
      // Show loading state
      const originalText = summonBtn.innerHTML;
      summonBtn.innerHTML = '<div class="spinner"></div>';
      summonBtn.disabled = true;
      singleSummon.disabled = true;

      try {
        const gtiles = Array.from(document.querySelectorAll('.gtiles .gtile'));
        let cycles = full ? 30 + Math.floor(Math.random()*20) : 12 + Math.floor(Math.random()*8);
        
        for(let i=0;i<cycles;i++){
          gtiles.forEach(t=>t.classList.remove('sel'));
          const sel = gtiles[i % gtiles.length];
          sel.classList.add('sel');
          await sleep(40 + Math.floor(i*i/30));
        }

        const chosenRarity = chooseRarity();
        const winnerPanel = pickPanelByRarity(chosenRarity);
        
        await sleep(350);
        await revealPanel(winnerPanel);
        
      } catch (error) {
        console.error('Summon error:', error);
        alert('Terjadi error saat summon. Coba lagi.');
      } finally {
        // Reset button state
        summonBtn.innerHTML = originalText;
        summonBtn.disabled = false;
        singleSummon.disabled = false;
      }
    }

    // Bind summon buttons
    summonBtn.addEventListener('click', ()=>performSummon(true));
    singleSummon.addEventListener('click', ()=>performSummon(false));

    // Result handlers
    claimBtn.addEventListener('click', ()=>{
      const f = claimBtn.dataset.file || '';
      if(!f){ 
        alert('No file linked. Implement server-side claim to enable single-use downloads.'); 
        return; 
      }
      window.open(f, '_blank');
    });

    closeResult.addEventListener('click', ()=>{ 
      resultOverlay.classList.remove('open');
      resultOverlay.setAttribute('aria-hidden', 'true');
      panels.forEach(x=>x.classList.remove('sel')); 
    });

    // Background music with better error handling
    const bgMusic = document.getElementById('bgMusic');
    document.addEventListener('click', ()=>{ 
      bgMusic.play().catch((e)=>{
        console.log('Autoplay blocked:', e);
      }); 
    }, {once:true});

    /* ---------------------- INITIALIZATION ---------------------- */
    // Initialize slider
    updateSlider();
    
    // Preload images
    document.addEventListener('DOMContentLoaded', preloadImages);
    
    // Add error handlers to all images
    document.querySelectorAll('img').forEach(img => {
      img.addEventListener('error', () => handleImageError(img));
    });

    // Prevent text selection
    document.addEventListener('selectstart', e => { 
      if(e.target.closest('.carousel')) e.preventDefault(); 
    });

    // Developer API
    window.GACHA = {
      setRates(newRates){
        for(const k in newRates) if(newRates.hasOwnProperty(k)) rarityRates[k] = newRates[k];
        const sum = Object.values(rarityRates).reduce((s,x)=>s+x,0);
        for(const k in rarityRates) rarityRates[k] = rarityRates[k]/sum;
        cdf = []; let s=0; for(const k of Object.keys(rarityRates)){ s+=rarityRates[k]; cdf.push({key:k,at:s}); }
        updateRatesSummary();
      },
      getRates(){ return Object.assign({}, rarityRates); },
      goToSlide: goToSlide,
      currentSlide: () => currentSlide
    };

    console.log('🎮 Gacha Showcase loaded with shine effects & auras!');
  </script>
</body>
</html>
