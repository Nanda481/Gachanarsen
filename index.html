<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>High-Tier Gacha Showcase • Subscription Required</title>
  <meta name="description" content="High-end cinematic gacha showcase — Subscribe to access summon features"/>
  <style>
    /* ... (CSS sebelumnya tetap sama) ... */

    /* Subscription Verification Modal */
    .verification-modal {
      position: fixed;
      inset: 0;
      z-index: 70;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,6,12,0.95);
      backdrop-filter: blur(10px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    
    .verification-modal.active {
      opacity: 1;
      pointer-events: auto;
    }
    
    .verification-content {
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      padding: 40px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      text-align: center;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 40px 140px rgba(2,6,20,0.9);
      position: relative;
      overflow: hidden;
    }
    
    .verification-content::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(from 0deg, transparent, rgba(57,210,255,0.1), transparent);
      animation: rotateAura 8s linear infinite;
    }
    
    .verification-icon {
      font-size: 48px;
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }
    
    .verification-title {
      color: var(--accent-a);
      font-size: 24px;
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }
    
    .verification-text {
      color: var(--muted);
      margin-bottom: 24px;
      line-height: 1.6;
      position: relative;
      z-index: 1;
    }
    
    .verification-steps {
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      padding: 20px;
      margin: 24px 0;
      text-align: left;
      position: relative;
      z-index: 1;
      border: 1px solid rgba(255,255,255,0.05);
    }
    
    .verification-step {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 8px;
      border-radius: 8px;
      transition: background 0.3s ease;
    }
    
    .verification-step:hover {
      background: rgba(255,255,255,0.03);
    }
    
    .step-number {
      width: 24px;
      height: 24px;
      background: linear-gradient(45deg, var(--accent-a), var(--accent-b));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 800;
      color: #021226;
    }
    
    .step-text {
      color: var(--muted);
      font-size: 14px;
    }
    
    .verification-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      position: relative;
      z-index: 1;
    }
    
    .verification-btn {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .verification-btn.primary {
      background: linear-gradient(45deg, var(--accent-a), var(--accent-b));
      color: #021226;
    }
    
    .verification-btn.secondary {
      background: rgba(255,255,255,0.05);
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .verification-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(57,210,255,0.2);
    }
    
    .subscription-badge {
      background: linear-gradient(45deg, #FF0000, #CC0000);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-left: 8px;
      animation: pulse 2s infinite;
    }
    
    .verification-success {
      background: linear-gradient(45deg, #00C851, #007E33);
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      margin: 20px 0;
      display: none;
      align-items: center;
      gap: 10px;
      justify-content: center;
      position: relative;
      z-index: 1;
    }
    
    .verification-success.show {
      display: flex;
    }
    
    .access-granted {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(45deg, #00C851, #007E33);
      color: white;
      padding: 20px 40px;
      border-radius: 15px;
      font-weight: 800;
      font-size: 18px;
      z-index: 80;
      box-shadow: 0 20px 60px rgba(0,200,81,0.3);
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .access-granted.show {
      transform: translate(-50%, -50%) scale(1);
    }

    /* Enhanced security indicators */
    .security-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.02);
      border-radius: 8px;
      margin: 10px 0;
      position: relative;
      z-index: 1;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ff4444;
      animation: pulse 2s infinite;
    }
    
    .status-dot.verified {
      background: #00C851;
    }
    
    .status-text {
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
    }

    /* Disabled state for unsubscribed users */
    .gacha-disabled {
      position: relative;
    }
    
    .gacha-disabled::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(5px);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--accent-a);
      font-weight: 800;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="top" role="banner" aria-label="Header utama">
      <div class="shine-effect"></div>
      <div class="brand">
        <div class="logo" aria-label="Logo Gacha">G</div>
        <div>
          <div class="title">Gacha • Event Showcase 
            <span class="subscription-badge" id="subBadge" style="display: none;">
              <span>✓</span> SUBSCRIBED
            </span>
          </div>
          <div class="subtitle">Limited Summon • Subscription Required</div>
        </div>
      </div>

      <nav class="controls" aria-label="Navigasi kontrol">
        <button id="modeBtn" class="btn ghost small">Mode: Showcase</button>
        <button id="openChannel" class="btn small">Verify Subscription</button>
        <button id="enableBtn" class="btn primary" style="display: none;">Access Gacha</button>
      </nav>
    </header>

    <main class="main" role="main" aria-label="Konten utama">
      <!-- LEFT: info -->
      <aside class="left" aria-label="Informasi panel">
        <div class="card">
          <h4>Subscription Required</h4>
          <div class="security-status">
            <div class="status-dot" id="statusDot"></div>
            <div class="status-text" id="statusText">Verification Required</div>
          </div>
          <p class="muted">Subscribe to our YouTube channel to unlock summon features. Verification is required for access.</p>
        </div>

        <div class="card">
          <h4>Rarity Rates</h4>
          <p class="muted" id="ratesSummary">Mythic: 2% • Legendary: 8% • Elite: 20% • Common: 70%</p>
        </div>

        <div class="card">
          <h4>How to Verify</h4>
          <p class="muted">1. Click "Verify Subscription"<br>2. Open our YouTube channel<br>3. Subscribe if not already<br>4. Return and verify</p>
        </div>
      </aside>

      <!-- CENTER: showcase & gacha -->
      <section class="center" aria-label="Area showcase dan gacha">
        <div class="bg-container" id="bgContainer"></div>
        <div class="bg-overlay"></div>

        <!-- SHOWCASE MODE -->
        <div class="showcase-wrap" id="showcaseWrap">
          <!-- ... (showcase content sama seperti sebelumnya) ... -->
        </div>

        <!-- GACHA MODE -->
        <div class="gacha-board hide" id="gachaBoard" aria-label="Portal summon gacha">
          <div style="display:flex;flex-direction:column;gap:8px;min-width:200px;position:relative;z-index:1">
            <div style="font-weight:800; font-size:16px">Summon Portal</div>
            <div class="muted" style="font-size:13px">Subscription verified ✓ Ready to summon!</div>
          </div>

          <div class="gtiles" id="gtiles" style="position:relative;z-index:1">
            <!-- 6 box thumbnails -->
          </div>

          <div style="display:flex;flex-direction:column;gap:12px;align-items:center;position:relative;z-index:1">
            <button id="summonBtn" class="spin-btn">SUMMON</button>
            <button id="singleSummon" class="btn small">Single</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Verification Modal -->
  <div class="verification-modal" id="verificationModal">
    <div class="verification-content">
      <div class="verification-icon">🔒</div>
      <h2 class="verification-title">Subscription Required</h2>
      <p class="verification-text">To access summon features, you need to be subscribed to our YouTube channel.</p>
      
      <div class="verification-steps">
        <div class="verification-step">
          <div class="step-number">1</div>
          <div class="step-text">Click the button below to open our YouTube channel</div>
        </div>
        <div class="verification-step">
          <div class="step-number">2</div>
          <div class="step-text">Subscribe to the channel if you haven't already</div>
        </div>
        <div class="verification-step">
          <div class="step-number">3</div>
          <div class="step-text">Return to this page and click "I've Subscribed"</div>
        </div>
        <div class="verification-step">
          <div class="step-number">4</div>
          <div class="step-text">Complete verification to unlock summon features</div>
        </div>
      </div>

      <div class="verification-success" id="verificationSuccess">
        <span>✓</span> Subscription verified successfully!
      </div>

      <div class="verification-actions">
        <button class="verification-btn secondary" id="closeVerification">Cancel</button>
        <button class="verification-btn primary" id="openYoutube">Open YouTube Channel</button>
        <button class="verification-btn primary" id="confirmSubscription" style="display: none;">I've Subscribed ✓</button>
      </div>
    </div>
  </div>

  <!-- Access Granted Animation -->
  <div class="access-granted" id="accessGranted">
    <span>🎮</span> GACH ACCESS GRANTED!
  </div>

  <!-- ... (result overlay, notification, music sama seperti sebelumnya) ... -->
</body>

<script>
/************************************************************************
 * ENHANCED SUBSCRIPTION VERIFICATION SYSTEM
 * - Multi-layer verification without YouTube API
 * - Timestamp-based security
 * - Local storage with expiration
 * - User behavior analysis
 ************************************************************************/

/* ---------------------- CONFIG ---------------------- */
const CONFIG = {
  YOUTUBE_CHANNEL: 'https://youtube.com/@your-channel', // GANTI dengan channelmu
  VERIFICATION_TIMEOUT: 30 * 60 * 1000, // 30 menit
  SESSION_DURATION: 2 * 60 * 60 * 1000, // 2 jam
  MAX_VERIFICATION_ATTEMPTS: 3,
  SECURITY_DELAY: 2000 // 2 detik delay untuk security
};

const SECURITY_KEYS = {
  SUBSCRIPTION_VERIFIED: 'gacha_sub_verified',
  VERIFICATION_TIMESTAMP: 'gacha_verify_ts',
  SESSION_START: 'gacha_session_start',
  ATTEMPT_COUNT: 'gacha_attempts',
  CHANNEL_OPENED: 'gacha_channel_opened'
};

/* ---------------------- SECURITY SYSTEM ---------------------- */
class SubscriptionSecurity {
  constructor() {
    this.attempts = this.getAttemptCount();
    this.isVerified = this.checkVerification();
    this.init();
  }

  init() {
    this.setupEventListeners();
    this.updateUI();
    this.cleanupExpiredData();
  }

  // Security: Check if user is verified
  checkVerification() {
    const verified = localStorage.getItem(SECURITY_KEYS.SUBSCRIPTION_VERIFIED);
    const sessionStart = localStorage.getItem(SECURITY_KEYS.SESSION_START);
    
    if (!verified || !sessionStart) return false;
    
    const sessionAge = Date.now() - parseInt(sessionStart);
    return sessionAge < CONFIG.SESSION_DURATION;
  }

  // Security: Get attempt count with reset after timeout
  getAttemptCount() {
    const attempts = localStorage.getItem(SECURITY_KEYS.ATTEMPT_COUNT);
    const timestamp = localStorage.getItem(SECURITY_KEYS.VERIFICATION_TIMESTAMP);
    
    if (!attempts || !timestamp) return 0;
    
    const timeSinceLastAttempt = Date.now() - parseInt(timestamp);
    if (timeSinceLastAttempt > CONFIG.VERIFICATION_TIMEOUT) {
      this.resetAttempts();
      return 0;
    }
    
    return parseInt(attempts);
  }

  // Security: Increment attempt count
  incrementAttempts() {
    this.attempts++;
    localStorage.setItem(SECURITY_KEYS.ATTEMPT_COUNT, this.attempts.toString());
    localStorage.setItem(SECURITY_KEYS.VERIFICATION_TIMESTAMP, Date.now().toString());
  }

  // Security: Reset attempts after timeout
  resetAttempts() {
    this.attempts = 0;
    localStorage.removeItem(SECURITY_KEYS.ATTEMPT_COUNT);
    localStorage.removeItem(SECURITY_KEYS.VERIFICATION_TIMESTAMP);
  }

  // Security: Mark channel as opened
  markChannelOpened() {
    localStorage.setItem(SECURITY_KEYS.CHANNEL_OPENED, Date.now().toString());
  }

  // Security: Check if channel was recently opened
  wasChannelOpened() {
    const opened = localStorage.getItem(SECURITY_KEYS.CHANNEL_OPENED);
    if (!opened) return false;
    
    const timeSinceOpened = Date.now() - parseInt(opened);
    return timeSinceOpened < CONFIG.VERIFICATION_TIMEOUT;
  }

  // Security: Verify subscription (multi-layer check)
  async verifySubscription() {
    // Layer 1: Check if channel was opened recently
    if (!this.wasChannelOpened()) {
      this.showNotification('❌ Please open the YouTube channel first');
      return false;
    }

    // Layer 2: Check attempt limits
    if (this.attempts >= CONFIG.MAX_VERIFICATION_ATTEMPTS) {
      this.showNotification('❌ Too many attempts. Please try again later.');
      return false;
    }

    // Layer 3: Security delay to prevent automation
    this.showNotification('🔒 Verifying subscription...');
    await this.delay(CONFIG.SECURITY_DELAY);

    // Layer 4: User behavior analysis (simple version)
    const userBehaviorScore = this.analyzeUserBehavior();
    if (userBehaviorScore < 0.7) {
      this.showNotification('❌ Verification failed. Please try the process again.');
      this.incrementAttempts();
      return false;
    }

    // Layer 5: Final verification
    return this.finalizeVerification();
  }

  // Security: Analyze user behavior patterns
  analyzeUserBehavior() {
    let score = 0;
    
    // Check if user spent reasonable time (simulated)
    const channelOpenedTime = localStorage.getItem(SECURITY_KEYS.CHANNEL_OPENED);
    if (channelOpenedTime) {
      const timeSpent = Date.now() - parseInt(channelOpenedTime);
      // Minimum 5 seconds, maximum 5 minutes considered reasonable
      if (timeSpent > 5000 && timeSpent < 300000) score += 0.4;
    }
    
    // Check if this is not first attempt (returning user)
    if (this.attempts > 0) score += 0.3;
    
    // Random factor to prevent automation
    score += Math.random() * 0.3;
    
    return Math.min(score, 1);
  }

  // Security: Final verification step
  finalizeVerification() {
    // Set verification flags
    localStorage.setItem(SECURITY_KEYS.SUBSCRIPTION_VERIFIED, 'true');
    localStorage.setItem(SECURITY_KEYS.SESSION_START, Date.now().toString());
    this.resetAttempts();
    
    this.isVerified = true;
    this.showNotification('✅ Subscription verified! Gacha access granted.');
    return true;
  }

  // Security: Cleanup expired data
  cleanupExpiredData() {
    const sessionStart = localStorage.getItem(SECURITY_KEYS.SESSION_START);
    if (sessionStart) {
      const sessionAge = Date.now() - parseInt(sessionStart);
      if (sessionAge > CONFIG.SESSION_DURATION) {
        this.resetSession();
      }
    }
  }

  // Security: Reset session
  resetSession() {
    localStorage.removeItem(SECURITY_KEYS.SUBSCRIPTION_VERIFIED);
    localStorage.removeItem(SECURITY_KEYS.SESSION_START);
    this.isVerified = false;
    this.updateUI();
  }

  // UI Updates
  updateUI() {
    const subBadge = document.getElementById('subBadge');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const enableBtn = document.getElementById('enableBtn');
    const summonBtn = document.getElementById('summonBtn');
    const singleSummon = document.getElementById('singleSummon');

    if (this.isVerified) {
      subBadge.style.display = 'inline-flex';
      statusDot.className = 'status-dot verified';
      statusText.textContent = 'Verified ✓';
      enableBtn.style.display = 'none';
      summonBtn.disabled = false;
      singleSummon.disabled = false;
    } else {
      subBadge.style.display = 'none';
      statusDot.className = 'status-dot';
      statusText.textContent = 'Verification Required';
      enableBtn.style.display = 'block';
      summonBtn.disabled = true;
      singleSummon.disabled = true;
    }
  }

  // Event Listeners
  setupEventListeners() {
    const openChannelBtn = document.getElementById('openChannel');
    const enableBtn = document.getElementById('enableBtn');
    const verificationModal = document.getElementById('verificationModal');
    const openYoutubeBtn = document.getElementById('openYoutube');
    const confirmSubscriptionBtn = document.getElementById('confirmSubscription');
    const closeVerificationBtn = document.getElementById('closeVerification');

    openChannelBtn.addEventListener('click', () => {
      this.showVerificationModal();
    });

    enableBtn.addEventListener('click', () => {
      this.showVerificationModal();
    });

    openYoutubeBtn.addEventListener('click', () => {
      this.openYouTubeChannel();
    });

    confirmSubscriptionBtn.addEventListener('click', async () => {
      const success = await this.verifySubscription();
      if (success) {
        this.showVerificationSuccess();
        setTimeout(() => {
          this.hideVerificationModal();
          this.showAccessGranted();
          this.updateUI();
        }, 2000);
      }
    });

    closeVerificationBtn.addEventListener('click', () => {
      this.hideVerificationModal();
    });
  }

  // Modal Controls
  showVerificationModal() {
    const modal = document.getElementById('verificationModal');
    const openYoutubeBtn = document.getElementById('openYoutube');
    const confirmSubscriptionBtn = document.getElementById('confirmSubscription');
    
    modal.classList.add('active');
    
    // Reset button states
    openYoutubeBtn.style.display = 'block';
    confirmSubscriptionBtn.style.display = 'none';
  }

  hideVerificationModal() {
    const modal = document.getElementById('verificationModal');
    modal.classList.remove('active');
  }

  showVerificationSuccess() {
    const successElement = document.getElementById('verificationSuccess');
    successElement.classList.add('show');
  }

  // YouTube Channel Handler
  openYouTubeChannel() {
    // Mark channel as opened
    this.markChannelOpened();
    
    // Open channel in new tab
    window.open(CONFIG.YOUTUBE_CHANNEL, '_blank');
    
    // Show confirmation button after a delay
    setTimeout(() => {
      const openYoutubeBtn = document.getElementById('openYoutube');
      const confirmSubscriptionBtn = document.getElementById('confirmSubscription');
      
      openYoutubeBtn.style.display = 'none';
      confirmSubscriptionBtn.style.display = 'block';
    }, 1000);
  }

  // Access Granted Animation
  showAccessGranted() {
    const accessElement = document.getElementById('accessGranted');
    accessElement.classList.add('show');
    
    setTimeout(() => {
      accessElement.classList.remove('show');
    }, 3000);
  }

  // Utility Functions
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  showNotification(message) {
    // Use existing notification system
    if (window.showNotification) {
      window.showNotification(message);
    } else {
      console.log('Notification:', message);
    }
  }
}

/* ---------------------- INITIALIZATION ---------------------- */
// Initialize security system
const securitySystem = new SubscriptionSecurity();

// Expose to global scope for other functions
window.securitySystem = securitySystem;

// Update existing enableBtn behavior
document.getElementById('enableBtn').addEventListener('click', function() {
  securitySystem.showVerificationModal();
});

// Modify existing summon buttons to check verification
document.getElementById('summonBtn').addEventListener('click', function(e) {
  if (!securitySystem.isVerified) {
    e.preventDefault();
    securitySystem.showVerificationModal();
    securitySystem.showNotification('🔒 Subscription required for summoning');
    return false;
  }
  // Continue with existing summon logic
  if (window.performSummon) {
    window.performSummon(true);
  }
});

document.getElementById('singleSummon').addEventListener('click', function(e) {
  if (!securitySystem.isVerified) {
    e.preventDefault();
    securitySystem.showVerificationModal();
    securitySystem.showNotification('🔒 Subscription required for summoning');
    return false;
  }
  // Continue with existing summon logic
  if (window.performSummon) {
    window.performSummon(false);
  }
});

// Auto-cleanup every hour
setInterval(() => {
  securitySystem.cleanupExpiredData();
}, 60 * 60 * 1000);

console.log('🔒 Subscription Security System Activated');
</script>
</html>
